---
layout: post
title:  "GROUP"
date:   2018-12-29 14:55:30 +0800
categories: [MMU]
excerpt: LD scripts key GROUP.
tags:
  - Linker
---

# GROUP

{% highlight ruby %}
GROUP(files)
GROUP(file0 file1 file2 ...)
{% endhighlight %}

æŒ‡å®šéœ€è¦é‡å¤æœç´¢ç¬¦å·å®šä¹‰çš„å¤šä¸ªè¾“å…¥æ–‡ä»¶ã€‚file å¿…é¡»æ˜¯åº“æ–‡ä»¶ï¼Œä¸” file æ–‡ä»¶ä½œä¸ºä¸€
ç»„è¢« ld é‡å¤æ‰«æï¼Œç›´åˆ°ä¸åœ¨æœ‰æ–°çš„æœªå®šä¹‰çš„å¼•ç”¨å‡ºç°ã€‚

**e.g.** ä¸‰ä¸ªæºæ–‡ä»¶ DemoA.cï¼ŒDemoC.c å’Œ DemoB.cï¼Œå…¶ä¸­ DemoB.c å¼•ç”¨ DemoA.c å’Œ 
DemoC.c é‡Œé¢çš„å‡½æ•°ï¼Œä½¿ç”¨ GCC ç”Ÿæˆç‹¬ç«‹çš„ç›®æ ‡æ–‡ä»¶ DemoB.oï¼Œç„¶åå°† DemoA.c å’Œ 
DemoC.c ç”ŸæˆåŠ¨æ€åº“ libDemoA.so å’Œ libDemoC.soã€‚ ld ä½¿ç”¨é“¾æ¥è„šæœ¬ Demo.lds, å¹¶ä¸”
åœ¨ Demo.lds é‡Œé¢ä½¿ç”¨ GROUP å…³é”®å­—æ‰«æ libDemoA.so å’Œ libDemoC.soï¼š

DemoA.c

{% highlight ruby %}
int out(int a, int b)
{
    reutrn a + b;
}
{% endhighlight %}

DemoB.c

{% highlight ruby %}
extern int out(int a, int b);
extern int in(int a, int b);

int nomain(void)
{
    out(2, 3);
    in(2, 3);
    return 0;
}
{% endhighlight %}

DemoC.c

{% highlight ruby %}
int in(int a, int b)
{
    return a - b;
}
{% endhighlight %}

Demo.lds

{% highlight ruby %}
ENTRY(nomain)
GROUP(libDemoA.so libDemoC.so)

SECTIONS
{
    . = 0x08048000 + SIZEOF_HEADERS;

    Demotext ï¼š{ *(.text) *(.data) *(.rodata) }
}
{% endhighlight %}

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘å’Œé“¾æ¥ï¼š

{% highlight ruby %}
gcc -shared -fPIC demoA.c -o libDemoA.so
gcc -shared -fPIC demoC.c -o libDemoC.so
gcc demoB.c -c
ld -T Demo.lds demoB.o -o a.out
{% endhighlight %}

é“¾æ¥æˆåŠŸä¹‹åç”Ÿæˆ a.out å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½¿ç”¨ objdump å·¥å…·æŸ¥çœ‹ a.out çš„ ELF æ–‡ä»¶å¸ƒå±€ï¼š

{% highlight ruby %}
objdump -sSdhx a.out
{% endhighlight %}

-----------------------------------------------

# <span id="é™„å½•">é™„å½•</span>

> [BiscuitOS Home](https://biscuitos.github.io/)
>
> [BiscuitOS Driver](https://biscuitos.github.io/blog/BiscuitOS_Catalogue/)
>
> [BiscuitOS Kernel Build](https://biscuitos.github.io/blog/Kernel_Build/)
>
> [Linux Kernel](https://www.kernel.org/)
>
> [Bootlin: Elixir Cross Referencer](https://elixir.bootlin.com/linux/latest/source)

## èµèµä¸€ä¸‹å§ ğŸ™‚

![MMU](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/HAB000036.jpg)
