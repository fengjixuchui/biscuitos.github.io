---
layout: post
title:  "IDR: ID Radix"
date:   2019-06-04 05:30:30 +0800
categories: [HW]
excerpt: IDR.
tags:
  - Tree
---

![DTS](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/IND00000I.jpg)

> [Github: IDR](https://github.com/BiscuitOS/HardStack/tree/master/Algorithem/IDR)
>
> Email: BuddyZhang1 <buddy.zhang@aliyun.com>

# ç›®å½•

> - [IDR åŸç†](#CS00)
>
>   - [IDR ç®€ä»‹](#IDR ç®€ä»‹)
>
>   - [å†…æ ¸ä¸­çš„ IDR](#å†…æ ¸ä¸­çš„ IDR)
>
>   - [IDR çš„æ¶æ„åŸç†](#IDR çš„æ¶æ„åŸç†)
>
> - [IDR æœ€å°å®è·µ](#å®è·µ)
>
>   - [IDR å†…æ ¸ä¸­æœ€å°å®è·µ](#IDR å†…æ ¸ä¸­æœ€å°å®è·µ)
>
>   - [IDR åœ¨åº”ç”¨ç¨‹åºä¸­æœ€å°å®è·µ](#IDR åœ¨åº”ç”¨ç¨‹åºä¸­æœ€å°å®è·µ)
>
> - [IDR åœ¨å†…æ ¸ä¸­çš„åº”ç”¨](#CS01)
>
>   - [IDR åˆå§‹åŒ–æ“ä½œ](#AD5)
>
>   - [IDR æ’å…¥æ“ä½œ](#AD0)
>
>   - [IDR æŸ¥è¯¢æ“ä½œ](#AD1)
>
>   - [IDR ä¿®æ”¹æ“ä½œ](#AD2)
>
>   - [IDR åˆ é™¤æ“ä½œ](#AD3)
>
>   - [IDR éå†æ“ä½œ](#AD4)
>
>   - [IDR å…¶ä»–æ“ä½œ](#AD6)
>
> - [IDR åœ¨åº”ç”¨ç¨‹åºä¸­éƒ¨ç½²](https://biscuitos.github.io/blog/IDR_UserArrange/)
>
> - [IDR è¿›é˜¶ç ”ç©¶](https://biscuitos.github.io/blog/IDR_Advance/)
>
> - [ä½¿ç”¨ Data Structure Visualizations åŠ¨æ€åˆ†æ ID Radix](https://www.cs.usfca.edu/~galles/visualization/RadixTree.html)
>
> - [IDR å†…æ ¸æ¥å£å‡½æ•°åˆ—è¡¨](#LIST)
>
> - [é™„å½•](#é™„å½•)

-----------------------------------

# <span id="CS00"></span>

![DTS](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/IND00000A.jpg)

# IDR åŸç†

> - [IDR ç®€ä»‹](#IDR ç®€ä»‹)
>
> - [å†…æ ¸ä¸­çš„ IDR](#å†…æ ¸ä¸­çš„ IDR)
>
> - [IDR çš„æ¶æ„åŸç†](#IDR çš„æ¶æ„åŸç†)

### <span id="IDR ç®€ä»‹">IDR ç®€ä»‹</span>

ç³»ç»Ÿè®¸å¤šèµ„æºéƒ½ç”¨æ•´æ•° ID æ¥æ ‡è¯†ï¼Œå¦‚è¿›ç¨‹ IDã€æ–‡ä»¶æè¿°ç¬¦ IDã€IPC ID ç­‰ï¼›èµ„æºä¿¡æ¯
é€šå¸¸å­˜æ”¾åœ¨å¯¹åº”çš„æ•°æ®ç»“æ„ä¸­ (å¦‚è¿›ç¨‹ä¿¡æ¯å­˜æ”¾åœ¨ task_struct ä¸­ã€ipc ä¿¡æ¯å­˜æ”¾åœ¨
ipc_perm ä¸­)ï¼Œid ä¸ æ•°æ®ç»“æ„çš„å…³è”æœºåˆ¶æœ‰ä¸åŒçš„å®ç°ï¼ŒIDR æœºåˆ¶æ˜¯å…¶ä¸­çš„ä¸€ç§ã€‚

IDRï¼ŒID Radix çš„ç¼©å†™ã€‚IDR ä¸»è¦ç”¨äºå»ºç«‹ id ä¸æŒ‡é’ˆ(æŒ‡å‘å¯¹åº”çš„æ•°æ®ç»“æ„) ä¹‹é—´çš„
å¯¹åº”å…³ç³»ã€‚IDR ç”¨ç±»åŸºæ•°æ ‘ç»“æ„æ¥æ„é€ ä¸€ä¸ªç¨€ç–æ•°ç»„ï¼Œä»¥ id ä¸ºç´¢å¼•æ‰¾åˆ°å¯¹åº”æ•°ç»„å…ƒç´ ï¼Œ
è¿›è€Œæ‰¾åˆ°å¯¹åº”çš„æ•°æ®ç»“æ„æŒ‡é’ˆã€‚ç”¨åˆ° IDR æœºåˆ¶çš„ä¸»è¦æœ‰ï¼šIPC id (æ¶ˆæ¯é˜Ÿåˆ— idã€
ä¿¡å·é‡ idã€å…±äº«å†…å­˜ id ç­‰)ï¼Œç£ç›˜åˆ†åŒº id (sda ä¸­æ•°å­—éƒ¨åˆ†ï¼‰ç­‰ã€‚

-----------------------------------

### <span id="å†…æ ¸ä¸­çš„ IDR">å†…æ ¸ä¸­çš„ IDR</span>

Linux å†…æ ¸æä¾›äº†ä¸€å¥—å®Œæ•´çš„ IDR å®ç°æœºåˆ¶ï¼Œå…¶åŸºäº Radix-treeã€‚åœ¨ linux 4.19 ä¹‹å‰
å†…æ ¸å¹¶æœªé‡‡ç”¨ xarray ä»£æ›¿ radixï¼Œä½† linux 4.20 ä¹‹åï¼Œå†…æ ¸é‡‡ç”¨ xarray æ›¿ä»£äº†
radix-treeï¼Œå› æ­¤ IDR çš„åº•å±‚å®ç°ä¹Ÿå‘ç”Ÿäº†æ”¹å˜ï¼Œä½†è¿™ä¸å½±å“ä¸Šå±‚ IDR çš„æ¥å£åŠŸèƒ½ã€‚
å†…æ ¸å…³äº IDR çš„æºç ä½äºï¼š

{% highlight bash %}
include/linux/idr.h
lib/idr.c
{% endhighlight %}

åœ¨ Linux å†…æ ¸ä¸­ï¼ŒIDR ä½œä¸ºé‡è¦çš„åŸºç¡€æ•°æ®ï¼Œå†…æ ¸å®šä¹‰äº†ç›¸åº”çš„æ•°æ®ç»“æ„å¯¹ IDR è¿›è¡Œç»´æŠ¤ã€‚

###### struct idr

{% highlight bash %}
struct idr {
        struct radix_tree_root  idr_rt;
        unsigned int            idr_base;
        unsigned int            idr_next;
};
{% endhighlight %}

å†…æ ¸å®šä¹‰äº† struct idr ç»“æ„ç”¨æ¥ç»´æŠ¤ä¸€ä¸ª IDRã€‚idr_rt æˆå‘˜å®šä¹‰äº†ä¸€æ£µ radix-tree æ ‘ï¼›
idr_base æˆå‘˜ç”¨äºæŒ‡å®š ID åˆ†é…çš„èµ·å§‹åœ°å€ï¼›idr_next æˆå‘˜æŒ‡å®šä¸‹ä¸€ä¸ª ID çš„åç§»å·ã€‚

-----------------------------------

### <span id="IDR çš„æ¶æ„åŸç†">IDR çš„æ¶æ„åŸç†</span>

Linux å†…æ ¸ä¸­ï¼Œæ¯ä¸ª IDR éƒ½åŒ…å«ä¸€ä¸ª radix-tree æ ‘ï¼Œå†…æ ¸åœ¨åˆå§‹åŒ–å®Œ IDR ä¹‹åï¼Œæ¯å½“
éœ€è¦åˆ†é…æ–°çš„ ID ä¸æŒ‡é’ˆç»‘å®šçš„æ—¶å€™ï¼ŒIDR é€šè¿‡è®¡ç®— idr_base + idr_next çš„å€¼è®¡ç®—ä¸‹ä¸€
ä¸ª ID çš„å€¼ï¼Œå¹¶ä¸”ä» radix-tree ä¸­æ‰¾åˆ° ID å¯¹åº”çš„ slot ä¾›å­˜å‚¨æŒ‡é’ˆã€‚ç”±äº ID ç”³è¯·
æ˜¯è¿ç»­çš„ï¼Œå› æ­¤ä» radix-tree æ¥çœ‹ï¼Œæ ‘éƒ½æ˜¯å¾€ä¸€ä¾§åç§»é€€åŒ–å½¢æˆä¸€ä¸ªç¨€ç–æ•°ç»„ã€‚å¦‚ä¸‹å›¾ï¼Œ
è¿ç»­çš„ ID å¯¼è‡´æ ‘çš„åç§»é€€åŒ–ã€‚

![DTS](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000126.png)

--------------------------------------------------
<span id="å®è·µ"></span>

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/IND00000B.jpg)

## IDR å®è·µ

> - [IDR å†…æ ¸ä¸­æœ€å°å®è·µ](#IDR å†…æ ¸ä¸­æœ€å°å®è·µ)
>
> - [IDR åœ¨åº”ç”¨ç¨‹åºä¸­æœ€å°å®è·µ](#IDR åœ¨åº”ç”¨ç¨‹åºä¸­æœ€å°å®è·µ)

--------------------------------------
<span id="IDR å†…æ ¸ä¸­æœ€å°å®è·µ"></span>

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/IND00000C.jpg)

### IDR å†…æ ¸ä¸­æœ€å°å®è·µ

> - [é©±åŠ¨æºç ](#AAé©±åŠ¨æºç )
>
> - [é©±åŠ¨å®‰è£…](#AAé©±åŠ¨å®‰è£…)
>
> - [é©±åŠ¨é…ç½®](#AAé©±åŠ¨é…ç½®)
>
> - [é©±åŠ¨ç¼–è¯‘](#AAé©±åŠ¨ç¼–è¯‘)
>
> - [é©±åŠ¨è¿è¡Œ](#AAé©±åŠ¨è¿è¡Œ)
>
> - [é©±åŠ¨åˆ†æ](#AAé©±åŠ¨åˆ†æ)

#### <span id="AAé©±åŠ¨æºç ">é©±åŠ¨æºç </span>

> [å®è·µæºç  IDR on GitHub](https://github.com/BiscuitOS/HardStack/tree/master/Algorithem/IDR/API/mini)

{% highlight c %}
/*
 * IDR.
 *
 * (C) 2019.06.04 <buddy.zhang@aliyun.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

#include <linux/kernel.h>
#include <linux/init.h>
#include <linux/mm.h>

/* header of radix-tree */
#include <linux/idr.h>

/* private node */
struct node {
	const char *name;
};

/* Root of IDR */
static DEFINE_IDR(BiscuitOS_idr);

/* node set */
static struct node node0 = { .name = "IDA" };
static struct node node1 = { .name = "IDB" };
static struct node node2 = { .name = "IDC" };
static struct node node3 = { .name = "IDD" };
static struct node node4 = { .name = "IDE" };

/* ID array */
#define IDR_ARRAY_SIZE	5
static int idr_array[IDR_ARRAY_SIZE];

static __init int idr_demo_init(void)
{
	struct node *np;
	int id;

	/* proload for idr_alloc */
	idr_preload(GFP_KERNEL);

	/* Allocate a id from IDR */
	idr_array[0] = idr_alloc_cyclic(&BiscuitOS_idr, &node0, 1,
							INT_MAX, GFP_ATOMIC);
	idr_array[1] = idr_alloc_cyclic(&BiscuitOS_idr, &node1, 1,
							INT_MAX, GFP_ATOMIC);
	idr_array[2] = idr_alloc_cyclic(&BiscuitOS_idr, &node2, 1,
							INT_MAX, GFP_ATOMIC);
	idr_array[3] = idr_alloc_cyclic(&BiscuitOS_idr, &node3, 1,
							INT_MAX, GFP_ATOMIC);
	idr_array[4] = idr_alloc_cyclic(&BiscuitOS_idr, &node4, 1,
							INT_MAX, GFP_ATOMIC);

	/* Interate over all slots */
	idr_for_each_entry(&BiscuitOS_idr, np, id)
		printk("%s's ID %d\n", np->name, id);

	/* end preload section started with idr_preload() */
	idr_preload_end();

	return 0;
}
device_initcall(idr_demo_init);
{% endhighlight %}

#### <span id="é©±åŠ¨å®‰è£…">é©±åŠ¨å®‰è£…</span>

é©±åŠ¨çš„å®‰è£…å¾ˆç®€å•ï¼Œé¦–å…ˆå°†é©±åŠ¨æ”¾åˆ° drivers/BiscuitOS/ ç›®å½•ä¸‹ï¼Œå‘½åä¸º idr.cï¼Œ
ç„¶åä¿®æ”¹ Kconfig æ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹å‚è€ƒå¦‚ä¸‹ï¼š

{% highlight bash %}
diff --git a/drivers/BiscuitOS/Kconfig b/drivers/BiscuitOS/Kconfig
index 4edc5a5..1a9abee 100644
--- a/drivers/BiscuitOS/Kconfig
+++ b/drivers/BiscuitOS/Kconfig
@@ -6,4 +6,14 @@ if BISCUITOS_DRV
config BISCUITOS_MISC
        bool "BiscuitOS misc driver"
+config BISCUITOS_IDR
+       bool "IDR"
+
+if BISCUITOS_IDR
+
+config DEBUG_BISCUITOS_IDR
+       bool "IDR mini"
+
+endif # BISCUITOS_IDR
+
endif # BISCUITOS_DRV
{% endhighlight %}

æ¥ç€ä¿®æ”¹ Makefileï¼Œè¯·å‚è€ƒå¦‚ä¸‹ä¿®æ”¹ï¼š

{% highlight bash %}
diff --git a/drivers/BiscuitOS/Makefile b/drivers/BiscuitOS/Makefile
index 82004c9..9909149 100644
--- a/drivers/BiscuitOS/Makefile
+++ b/drivers/BiscuitOS/Makefile
@@ -1 +1,2 @@
obj-$(CONFIG_BISCUITOS_MISC)     += BiscuitOS_drv.o
+obj-$(CONFIG_BISCUITOS_IDR)     += idr.o
--
{% endhighlight %}

#### <span id="é©±åŠ¨é…ç½®">é©±åŠ¨é…ç½®</span>

é©±åŠ¨é…ç½®è¯·å‚è€ƒä¸‹é¢æ–‡ç« ä¸­å…³äºé©±åŠ¨é…ç½®ä¸€èŠ‚ã€‚åœ¨é…ç½®ä¸­ï¼Œå‹¾é€‰å¦‚ä¸‹é€‰é¡¹ï¼Œå¦‚ä¸‹ï¼š

{% highlight bash %}
Device Driver--->
    [*]BiscuitOS Driver--->
        [*]IDR
            [*]IDR mini
{% endhighlight %}

å…·ä½“è¿‡ç¨‹è¯·å‚è€ƒï¼š

> [Linux 4.19.1 å¼€å‘ç¯å¢ƒæ­å»º -- é©±åŠ¨é…ç½®](https://biscuitos.github.io/blog/Linux-4.19.1-arm32-Usermanual/#%E9%A9%B1%E5%8A%A8%E9%85%8D%E7%BD%AE)

#### <span id="AAé©±åŠ¨ç¼–è¯‘">é©±åŠ¨ç¼–è¯‘</span>

é©±åŠ¨ç¼–è¯‘ä¹Ÿè¯·å‚è€ƒä¸‹é¢æ–‡ç« å…³äºé©±åŠ¨ç¼–è¯‘ä¸€èŠ‚ï¼š

> [Linux 4.19.1 å¼€å‘ç¯å¢ƒæ­å»º -- é©±åŠ¨ç¼–è¯‘](https://biscuitos.github.io/blog/Linux-4.19.1-arm32-Usermanual/#%E7%BC%96%E8%AF%91%E9%A9%B1%E5%8A%A8)

#### <span id="AAé©±åŠ¨è¿è¡Œ">é©±åŠ¨è¿è¡Œ</span>

é©±åŠ¨çš„è¿è¡Œï¼Œè¯·å‚è€ƒä¸‹é¢æ–‡ç« ä¸­å…³äºé©±åŠ¨è¿è¡Œä¸€èŠ‚ï¼š

> [Linux 4.19.1 å¼€å‘ç¯å¢ƒæ­å»º -- é©±åŠ¨è¿è¡Œ](https://biscuitos.github.io/blog/Linux-4.19.1-arm32-Usermanual/#%E9%A9%B1%E5%8A%A8%E8%BF%90%E8%A1%8C)

å¯åŠ¨å†…æ ¸ï¼Œå¹¶æ‰“å°å¦‚ä¸‹ä¿¡æ¯ï¼š

{% highlight ruby %}
usbcore: registered new interface driver usbhid
usbhid: USB HID core driver
IDA's ID 1
IDB's ID 2
IDC's ID 3
IDD's ID 4
IDE's ID 5
aaci-pl041 10004000.aaci: ARM AC'97 Interface PL041 rev0 at 0x10004000, irq 24
aaci-pl041 10004000.aaci: FIFO 512 entries
oprofile: using arm/armv7-ca9
{% endhighlight %}

--------------------------------------
<span id="IDR åœ¨åº”ç”¨ç¨‹åºä¸­æœ€å°å®è·µ"></span>

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/IND00000E.jpg)

### IDR åœ¨åº”ç”¨ç¨‹åºä¸­æœ€å°å®è·µ

> - [å®è·µæºç ](#å®è·µæºç )
>
> - [æºç ç¼–è¯‘](#æºç ç¼–è¯‘)
>
> - [æºç è¿è¡Œ](#æºç è¿è¡Œ)
>
> - [è¿è¡Œåˆ†æ](#è¿è¡Œåˆ†æ)

#### <span id="å®è·µæºç ">å®è·µæºç </span>

> [å®è·µæºç  IDR on GitHub](https://github.com/BiscuitOS/HardStack/tree/master/Algorithem/IDR/Basic)

å¼€å‘è€…ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å¾—ï¼š

{% highlight ruby %}
wget https://raw.githubusercontent.com/BiscuitOS/HardStack/master/Algorithem/IDR/Basic/Makefile
wget https://raw.githubusercontent.com/BiscuitOS/HardStack/master/Algorithem/IDR/Basic/idr_run.c
wget https://raw.githubusercontent.com/BiscuitOS/HardStack/master/Algorithem/IDR/Basic/idr.c
wget https://raw.githubusercontent.com/BiscuitOS/HardStack/master/Algorithem/IDR/Basic/idr.h
wget https://raw.githubusercontent.com/BiscuitOS/HardStack/master/Algorithem/IDR/Basic/radix.c
wget https://raw.githubusercontent.com/BiscuitOS/HardStack/master/Algorithem/IDR/Basic/radix.h
{% endhighlight %}

å®è·µæºç å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š

{% highlight c %}
/*
 * IDR Manual.
 *
 * (C) 2019.06.01 <buddy.zhang@aliyun.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */
#include <stdio.h>
#include <stdlib.h>

/* IDR/IDA */
#include <idr.h>

/* private node */
struct node {
	const char *name;
};

/* Root of IDR */
static DEFINE_IDR(BiscuitOS_idr);

/* node set */
static struct node node0 = { .name = "IDA" };
static struct node node1 = { .name = "IDB" };
static struct node node2 = { .name = "IDC" };

/* ID array */
static int idr_array[8];

int main()
{
	struct node *np;
	int id;

	/* preload for idr_alloc() */
	idr_preload(GFP_KERNEL);

	/* Allocate a id from IDR */
	idr_array[0] = idr_alloc_cyclic(&BiscuitOS_idr, &node0, 1,
							INT_MAX, GFP_ATOMIC);
	idr_array[1] = idr_alloc_cyclic(&BiscuitOS_idr, &node1, 1,
							INT_MAX, GFP_ATOMIC);
	idr_array[2] = idr_alloc_cyclic(&BiscuitOS_idr, &node2, 1,
							INT_MAX, GFP_ATOMIC);

	idr_for_each_entry(&BiscuitOS_idr, np, id)
		printf("%s's ID %d\n", np->name, id);

	/* end preload section started with idr_preload() */
	idr_preload_end();
	return 0;
}
{% endhighlight %}

--------------------------------------

#### <span id="æºç ç¼–è¯‘">æºç ç¼–è¯‘</span>

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š

{% highlight ruby %}
make clean
make
{% endhighlight %}

--------------------------------------

#### <span id="æºç è¿è¡Œ">æºç è¿è¡Œ</span>

å®è·µæºç çš„è¿è¡Œå¾ˆç®€å•ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶ä¸”è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

{% highlight bash %}
IDR/Basic$ ./idr
IDA's ID 1
IDB's ID 2
IDC's ID 3
{% endhighlight %}

-----------------------------------

# <span id="CS01"></span>

![DTS](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/IND00000I.jpg)

# IDR åœ¨å†…æ ¸ä¸­çš„åº”ç”¨

> - [IDR åˆå§‹åŒ–æ“ä½œ](#AD5)
>
> - [IDR æ’å…¥æ“ä½œ](#AD0)
>
> - [IDR æŸ¥è¯¢æ“ä½œ](#AD1)
>
> - [IDR ä¿®æ”¹æ“ä½œ](#AD2)
>
> - [IDR åˆ é™¤æ“ä½œ](#AD3)
>
> - [IDR éå†æ“ä½œ](#AD4)
>
> - [IDR å…¶ä»–æ“ä½œ](#AD6)

------------------------------------

#### <span id="AD5">IDR åˆå§‹åŒ–æ“ä½œ</span>

IDR æœºåˆ¶ä¸­ï¼Œå†…æ ¸ä½¿ç”¨ struct idr æ•°æ®ç»“æ„ç»´æŠ¤ç€ IDRã€‚åœ¨ä½¿ç”¨ IDR ä¹‹å‰éœ€è¦å¯¹
IDR è¿›è¡Œåˆå§‹åŒ–ã€‚åˆå§‹åŒ–çš„å†…å®¹ä¸»è¦åŒ…æ‹¬ IDR åŒ…å« radix-tree çš„åˆå§‹åŒ–ï¼Œä»¥åŠ
åˆ†é… ID çš„èµ·å§‹å€¼ã€‚å†…æ ¸æä¾›äº†å¤šä¸ªæ¥å£å‡½æ•°ç”¨äº IDR çš„åˆå§‹åŒ–ï¼Œå¼€å‘è€…å¯ä»¥å‚è€ƒ
ä¸‹é¢çš„æ–‡ç« è¿›è¡Œå®è·µï¼š

> - [DEFINE_IDR](https://biscuitos.github.io/blog/IDR_DEFINE_IDR/)
>
> - [IDR_INIT](https://biscuitos.github.io/blog/IDR_IDR_INIT/)
>
> - [IDR_INIT_BASE](https://biscuitos.github.io/blog/IDR_IDR_INIT_BASE/)
>
> - [idr_init](https://biscuitos.github.io/blog/IDR_idr_init/)
>
> - [idr_init_base](https://biscuitos.github.io/blog/IDR_idr_init_base/)

------------------------------------

#### <span id="AD0">IDR æ’å…¥æ“ä½œ</span>

IDR æ’å…¥æ“ä½œå°±æ˜¯ä»å†…æ ¸ä¸­åˆ†é…ä¸€ä¸ª ID ä¸ç»™å®šçš„æŒ‡é’ˆè¿›è¡Œç»‘å®šæ“ä½œã€‚IDR æœºåˆ¶ä¸­ï¼Œ
é€šè¿‡åˆ†é…ä¸€ä¸ª ID ä¹‹åï¼Œå¹¶åœ¨ IDR å¯¹åº”çš„ radix-tree ä¸­æ‰¾åˆ° ID å¯¹åº”çš„ slotï¼Œ
ç„¶åå°†ç»™å®šçš„æŒ‡é’ˆå­˜å‚¨åœ¨ slot ä¸­ï¼Œä»¥æ­¤å®ç° ID ä¸æŒ‡é’ˆç»‘å®šçš„åŸç†ã€‚å†…æ ¸ä¹Ÿæä¾›äº†
ç›¸åº”çš„å‡½æ•°ç”¨äº ID çš„æ’å…¥æ“ä½œï¼Œå¼€å‘è€…å¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡ç« è¿›è¡Œå®è·µï¼š

> - [idr_alloc](https://biscuitos.github.io/blog/IDR_idr_alloc/)
>
> - [idr_alloc_cyclic](https://biscuitos.github.io/blog/IDR_idr_alloc_cyclic/)
>
> - [idr_alloc_u32](https://biscuitos.github.io/blog/IDR_idr_alloc_u32/)

------------------------------------

#### <span id="AD1">IDR æŸ¥è¯¢æ“ä½œ</span>

IDR æŸ¥è¯¢æ“ä½œå°±æ˜¯é€šè¿‡ ID æ‰¾åˆ°å¯¹åº”çš„æŒ‡é’ˆã€‚IDR é€šè¿‡ radix-tree æœºåˆ¶æä¾›çš„å‡½æ•°ï¼Œ
å®ç°äº† ID çš„å¿«é€ŸæŸ¥æ‰¾åˆ°å¯¹åº”çš„ slot ä¹‹åï¼Œä»¥æ­¤è·å¾—å¯¹åº”çš„æŒ‡é’ˆã€‚å†…æ ¸ä¹Ÿæä¾›äº†
ç›¸åº”çš„å‡½æ•°ç”¨äº ID çš„æŸ¥æ‰¾æ“ä½œï¼Œå¼€å‘è€…å¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡ç« è¿›è¡Œå®è·µï¼š

> - [idr_find](https://biscuitos.github.io/blog/IDR_idr_find/)

------------------------------------

#### <span id="AD2">IDR ä¿®æ”¹æ“ä½œ</span>

IDR ä¿®æ”¹æ“ä½œå°±æ˜¯é€šè¿‡ ID æ›¿æ¢ä¸ä¹‹ç»‘å®šçš„æŒ‡é’ˆã€‚IDR é€šè¿‡ radix-tree æœºåˆ¶æä¾›çš„å‡½æ•°ï¼Œ
æ‰¾åˆ° ID åœ¨ radix-tree ä¸­å¯¹åº”çš„ slotï¼Œç„¶åå°† slot çš„å€¼æ›¿æ¢æˆæ–°å€¼ï¼Œä»¥æ­¤å®ç°
IDR çš„ä¿®æ”¹æ“ä½œã€‚å†…æ ¸ä¹Ÿæä¾›äº†ç›¸åº”çš„å‡½æ•°ç”¨äº ID çš„ä¿®æ”¹æ“ä½œï¼Œå¼€å‘è€…å¯ä»¥å‚è€ƒä¸‹é¢çš„
æ–‡ç« è¿›è¡Œå®è·µï¼š

> - [idr_replace](https://biscuitos.github.io/blog/IDR_idr_replace/)

------------------------------------

#### <span id="AD3">IDR åˆ é™¤æ“ä½œ</span>

IDR åˆ é™¤æ“ä½œæŒ‡çš„æ˜¯è§£é™¤ ID ä¸ä¹‹ç»‘å®šçš„æŒ‡é’ˆå…³ç³»ã€‚IDR é€šè¿‡åˆ é™¤æ“ä½œå°† ID ä¸æŒ‡é’ˆ
è§£é™¤å…³ç³»ä¹‹åï¼Œå¹¶å›æ”¶ IDã€‚å†…æ ¸ä¹Ÿæä¾›äº†ç›¸åº”çš„å‡½æ•°ç”¨äº ID çš„åˆ é™¤æ“ä½œï¼Œå¼€å‘è€…å¯ä»¥
å‚è€ƒä¸‹é¢çš„æ–‡ç« è¿›è¡Œå®è·µï¼š

> - [idr_remove](https://biscuitos.github.io/blog/IDR_idr_remove/)

------------------------------------

#### <span id="AD4">IDR éå†æ“ä½œ</span>

IDR çš„éå†æ“ä½œæŒ‡çš„æ˜¯éå† IDR æ‰€æœ‰ ID å¯¹åº”çš„æŒ‡é’ˆã€‚å†…æ ¸ä¹Ÿæä¾›äº†ç›¸åº”çš„å‡½æ•°ç”¨äº ID
çš„éå†æ“ä½œï¼Œå¼€å‘è€…å¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡ç« è¿›è¡Œå®è·µï¼š

> - [idr_for_each](https://biscuitos.github.io/blog/IDR_idr_for_each/)
>
> - [idr_for_each_entry](https://biscuitos.github.io/blog/IDR_idr_for_each_entry/)
>
> - [idr_for_each_entry_ul](https://biscuitos.github.io/blog/IDR_idr_for_each_entry_ul/)

------------------------------------

#### <span id="AD6">IDR å…¶ä»–æ“ä½œ</span>

IDR æœºåˆ¶è¿˜æä¾›äº†è®¸å¤šæœ‰ç”¨çš„æ¥å£ï¼Œå¼€å‘è€…å¯ä»¥å‚è€ƒå¦‚ä¸‹æ–‡æ¡£è¿›è¡Œå®è·µï¼š

> - [idr_is_empty: åˆ¤æ–­ IDR æ˜¯å¦ä¸ºç©º](https://biscuitos.github.io/blog/IDR_idr_is_empty/)
>
> - [idr_get_cursor: è·å¾— IDR å½“å‰çš„ ID](https://biscuitos.github.io/blog/IDR_idr_get_cursor/)
>
> - [idr_get_free: è·å¾—ä¸€ä¸ªå¯ç”¨çš„å…¥å£](https://biscuitos.github.io/blog/IDR_idr_get_free/)
>
> - [idr_preload: é¢„å…ˆåŠ è½½ IDR](https://biscuitos.github.io/blog/IDR_idr_preload/)
>
> - [idr_preload_end: ç»“æŸ IDR çš„é¢„å…ˆåŠ è½½](https://biscuitos.github.io/blog/IDR_idr_preload_end/)
>
> - [idr_set_cursor: è®¾ç½® IDR å½“å‰çš„ ID](https://biscuitos.github.io/blog/IDR_idr_set_cursor/)

-----------------------------------

<span id="LIST"></span>

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/IND00000L.jpg)

## IDR å†…æ ¸æ¥å£å‡½æ•°åˆ—è¡¨

> - [DEFINE_IDR](https://biscuitos.github.io/blog/IDR_DEFINE_IDR/)
>
> - [idr_alloc](https://biscuitos.github.io/blog/IDR_idr_alloc/)
>
> - [idr_alloc_cyclic](https://biscuitos.github.io/blog/IDR_idr_alloc_cyclic/)
>
> - [idr_alloc_u32](https://biscuitos.github.io/blog/IDR_idr_alloc_u32/)
>
> - [idr_find](https://biscuitos.github.io/blog/IDR_idr_find/)
>
> - [idr_for_each](https://biscuitos.github.io/blog/IDR_idr_for_each/)
>
> - [idr_for_each_entry](https://biscuitos.github.io/blog/IDR_idr_for_each_entry/)
>
> - [idr_for_each_entry_ul](https://biscuitos.github.io/blog/IDR_idr_for_each_entry_ul/)
>
> - [IDR_INIT](https://biscuitos.github.io/blog/IDR_IDR_INIT/)
>
> - [IDR_INIT_BASE](https://biscuitos.github.io/blog/IDR_IDR_INIT_BASE/)
>
> - [idr_init](https://biscuitos.github.io/blog/IDR_idr_init/)
>
> - [idr_init_base](https://biscuitos.github.io/blog/IDR_idr_init_base/)
>
> - [idr_is_empty](https://biscuitos.github.io/blog/IDR_idr_is_empty/)
>
> - [idr_get_cursor](https://biscuitos.github.io/blog/IDR_idr_get_cursor/)
>
> - [idr_get_free](https://biscuitos.github.io/blog/IDR_idr_get_free/)
>
> - [idr_get_next](https://biscuitos.github.io/blog/IDR_idr_get_next/)
>
> - [idr_get_next_ul](https://biscuitos.github.io/blog/IDR_idr_get_next_ul/)
>
> - [idr_preload](https://biscuitos.github.io/blog/IDR_idr_preload/)
>
> - [idr_preload_end](https://biscuitos.github.io/blog/IDR_idr_preload_end/)
>
> - [idr_replace](https://biscuitos.github.io/blog/IDR_idr_replace/)
>
> - [idr_remove](https://biscuitos.github.io/blog/IDR_idr_remove/)
>
> - [idr_set_cursor](https://biscuitos.github.io/blog/IDR_idr_set_cursor/)

-----------------------------------------------

# <span id="é™„å½•">é™„å½•</span>

> [BiscuitOS Home](https://biscuitos.github.io/)
>
> [BiscuitOS Driver](https://biscuitos.github.io/blog/BiscuitOS_Catalogue/)
>
> [BiscuitOS Kernel Build](https://biscuitos.github.io/blog/Kernel_Build/)
>
> [Linux Kernel](https://www.kernel.org/)
>
> [Bootlin: Elixir Cross Referencer](https://elixir.bootlin.com/linux/latest/source)
>
> [æ­å»ºé«˜æ•ˆçš„ Linux å¼€å‘ç¯å¢ƒ](https://biscuitos.github.io/blog/Linux-debug-tools/)

## èµèµä¸€ä¸‹å§ ğŸ™‚

![MMU](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/HAB000036.jpg)
