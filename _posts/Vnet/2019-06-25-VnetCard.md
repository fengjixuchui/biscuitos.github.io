---
layout: post
title:  "Open VnetCard è™šæ‹Ÿç½‘å¡"
date:   2019-06-25 05:30:30 +0800
categories: [HW]
excerpt: Vnet.
tags:
  - OpenProject
---

![](https://gitee.com/BiscuitOS/GIFBaseX/raw/master/RPI/GIF000203.gif)

> [Github: Open VnetCard](https://github.com/WorkRoutine/VNet-Card)
>
> Email: BuddyZhang1 <buddy.zhang@aliyun.com>

# ç›®å½•

> - [VnetCard åŸç†](#A0)
>
> - [VnetCard ä½¿ç”¨](#B0)
>
>   - [VnetCard æºç ](#B00)
>
>   - [VnetCard ç¼–è¯‘](#B01)
>
>   - [VnetCard è¿è¡Œ](#B02)
>
>   - [VnetCard ç½‘å…³é…ç½®](#B03)
>
> - [VnetCard å®ç°](#C0)
>
>   - [Tun/Tap](#C00)
>
>   - [DMA](#C01)
>
>   - [Queue](#C02)
>
>   - [RingBuffer](#C03)
>
>   - [mmap](#C04)
>
>   - [Signal](#C05)
>
> - [VnetCard æµ‹è¯•](#D0)
>
>   - [ping](#D00)
>
>   - [ssh](#D01)
>
>   - [scp](#D02)
>
>   - [iperf TCP](#D03)
>
>   - [iperf UDP](#D04)
>
>   - [socket](#D05)
>
> - [VnetCard ä¼˜åŒ–](#E0)
>
> - [VnetCard é—®é¢˜åˆé›†](#F0)
>
> - [é™„å½•](#é™„å½•)

-----------------------------------
<span id="A0"></span>

![](https://gitee.com/BiscuitOS/GIFBaseX/raw/master/RPI/IND00000A.jpg)

## VnetCard åŸç†

Open VnetCard è™šæ‹Ÿç½‘å¡æ˜¯ä¸€ç§åœ¨æ²¡æœ‰çœŸå®ç½‘å¡å­˜åœ¨çš„ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨å…¶ä»–ç‰©ç†é“¾è·¯å……å½“
ç½‘å¡çš„æ•°æ®é“¾è·¯ï¼Œå¹¶é€šè¿‡ Linux æä¾›çš„ TUN/TAP æä¾›çš„æ¥å£å®ç°çš„ä¸€ç§è™šæ‹Ÿç½‘å¡ã€‚
Open VnetCard é¡¹ç›®ä¸­ï¼Œè™šæ‹Ÿç½‘å¡æ˜¯å°†ä¸€å— FPGA/ARM ç¡¬ä»¶å¹³å°é€šè¿‡ PCIe æ’å…¥åˆ° X86
ä¸»æœºä¸Šï¼Œé€šè¿‡ PCIe ä¸Šçš„ DMA å’Œ queue è¿›è¡Œç½‘ç»œç‰©ç†æ•°æ®çš„äº¤äº’ï¼Œå¹¶ä½¿ç”¨ TUN/TAP è™š
æ‹Ÿç½‘å¡å®Œæˆç‰©ç†æ•°æ®çš„ç½‘ç»œåè®®è§£æï¼Œå…¶å®ç°æ¡†æ¶å¦‚ä¸‹å›¾ï¼š

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000139.png)

VnetCard è™šæ‹Ÿç½‘å¡çš„å®ç°åŸç†å¹¶ä¸å¤æ‚ï¼ŒX86 ç«¯çš„å®ç°å’Œ FPGA/ARM ç«¯çš„å®ç°é€»è¾‘åŸºæœ¬
ä¸€ç›´ï¼Œä½†ä¹Ÿå­˜åœ¨ç»†å¾®å·®åˆ«ï¼Œè¿™é‡Œåˆ†åˆ«å¯¹ä¸¤ç«¯çš„å®ç°åŸç†åšä»‹ç»ã€‚

--------------------------------

### X86 åŸç†

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000140.png)

###### VnetCard å‘é€æ•°æ®

åœ¨ X86 ç«¯ç”¨æˆ·ç©ºé—´é€šè¿‡ä½¿ç”¨å„ç§å„æ ·çš„ç½‘ç»œå·¥å…·ï¼Œå°†æ•°æ®é€šè¿‡ Socket æ¥å£ä¼ é€’ç»™
Linux çš„ç½‘ç»œåè®®å±‚ï¼Œç½‘ç»œåè®®å±‚å†å°† socket ä¼ é€’çš„æ•°æ®è¿›è¡Œå°åŒ…ï¼Œç„¶åä¼ é€’ç»™
TUN/TAP é©±åŠ¨ã€‚TUN/TAP é©±åŠ¨åœ¨è·å¾—ç½‘ç»œå±‚ä¼ é€’ä¸‹æ¥çš„æ•°æ®ä¹‹åï¼Œå°†æ•°æ®é€šè¿‡
å­—ç¬¦è®¾å¤‡ï¼Œä»¥å­—èŠ‚æµçš„æ–¹å¼ä¼ é€’ç»™ TUN/TAP åœ¨ç”¨æˆ·ç©ºé—´çš„æ¥å£ï¼Œæ­¤æ—¶ VnetCard ä½¿
ç”¨ VFS ä¸º TUN/TAP æä¾›çš„ open/read æ¥å£ä» TUN/TAP ä¸­è·å¾—æ•°æ®æµï¼Œ
è·å¾—æ•°æ®æµä¹‹åï¼Œå°†å¤šä¸ªæ•°æ®æ‹¼åœ¨ä¸€èµ·æ”¾ç½®åœ¨ RingBuf ä¸­ï¼Œå½“ç¬¦åˆæŸä¸ªæ¡ä»¶ä¹‹åï¼Œ
VnetCard ä½¿ç”¨ DMA å°† RingBuffer ä¸­å‡†å¤‡å¥½çš„æ•°æ®ç» PCIe æ‹·è´åˆ° FPGA/ARM
ç‰©ç†å†…å­˜çš„æŒ‡å®šä½ç½®ï¼Œåœ¨æ‹·è´å®Œæ¯•åï¼ŒVnetCard é€šè¿‡ queue å‘Šè¯‰ FPGA/ARM æœ‰
æ–°çš„ç½‘ç»œæ•°æ®å·²ç»å‡†å¤‡å¥½ã€‚è‡³æ­¤ X86 ç«¯ VnetCard å‘é€æ•°æ®è¿‡ç¨‹å®Œæ¯•ã€‚

###### VnetCard æ¥æ”¶æ•°æ®

VnetCard é€šè¿‡è½®è¯¢çš„æ–¹å¼è¯»å– queue ä¸­çš„ä¿¡æ¯ï¼Œä»¥ç¡®å®šæ˜¯å¦æœ‰æ–°çš„æ•°æ®åˆ°è¾¾ã€‚å¦‚æœ
queue ä¸­æœ‰æ–°æ•°æ®çš„ä¿¡æ¯ï¼ŒVnetCard å°±ä» queue ä¸­è¯»å–æ–°æ•°æ®åœ¨ FPGA/ARM ä¸­çš„
ä¿¡æ¯ï¼Œç„¶åè°ƒç”¨ DMA ä» FPGA/ARM ç‰©ç†å†…å­˜çš„æŒ‡å®šä½ç½®ä¸Šè¯»å–æ•°æ®åˆ° VnetCard
çš„ RingBuffer ä¸­ï¼Œæ¥ç€ VnetCard å°±å°† RingBuffer ä¸­çš„æ–°æ•°æ®è¿›è¡Œæ‹†åŒ…åˆ†ç¦»
æˆ TUN/TAP è¯†åˆ«çš„å¸§ï¼Œç„¶åå°†è¿™äº›å¸§é€šè¿‡ VFS æä¾›çš„ open/write æ¥å£ï¼Œå†™å…¥
åˆ° TUN/TAP åœ¨ç”¨æˆ·ç©ºé—´çš„æ¥å£ï¼Œæ­¤æ—¶ TUN/TAP é©±åŠ¨æ”¶åˆ°å†™å…¥çš„æ•°æ®ï¼Œå¹¶å°†è¿™äº›
æ•°æ®ä¼ å…¥åˆ°ç½‘ç»œåè®®å±‚ï¼Œæœ€åé€šè¿‡ Socket ä¼ é€’ç»™ç”¨æˆ·ç©ºé—´å„ç§ç½‘ç»œå·¥å…·ã€‚è‡³æ­¤
X86 ç«¯ VnetCard æ¥æ”¶æ•°æ®è¿‡ç¨‹å®Œæ¯•ã€‚

--------------------------------------

### FPGA/ARM åŸç†

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000141.png)

###### VnetCard å‘é€æ•°æ®

åœ¨ FPGA/ARM ç«¯ç”¨æˆ·ç©ºé—´é€šè¿‡ä½¿ç”¨å„ç§å„æ ·çš„ç½‘ç»œå·¥å…·ï¼Œå°†æ•°æ®é€šè¿‡ Socket æ¥å£ä¼ é€’ç»™
Linux çš„ç½‘ç»œåè®®å±‚ï¼Œç½‘ç»œåè®®å±‚å†å°† socket ä¼ é€’çš„æ•°æ®è¿›è¡Œå°åŒ…ï¼Œç„¶åä¼ é€’ç»™
TUN/TAP é©±åŠ¨ã€‚TUN/TAP é©±åŠ¨åœ¨è·å¾—ç½‘ç»œå±‚ä¼ é€’ä¸‹æ¥çš„æ•°æ®ä¹‹åï¼Œå°†æ•°æ®é€šè¿‡
å­—ç¬¦è®¾å¤‡ï¼Œä»¥å­—èŠ‚æµçš„æ–¹å¼ä¼ é€’ç»™ TUN/TAP åœ¨ç”¨æˆ·ç©ºé—´çš„æ¥å£ï¼Œæ­¤æ—¶ VnetCard ä½¿
ç”¨ VFS ä¸º TUN/TAP æä¾›çš„ open/read æ¥å£ä» TUN/TAP ä¸­è·å¾—æ•°æ®æµï¼Œ
è·å¾—æ•°æ®æµä¹‹åï¼Œå°†å¤šä¸ªæ•°æ®æ‹¼åœ¨ä¸€èµ·æ”¾ç½®åœ¨ RingBuf ä¸­ï¼Œå½“ç¬¦åˆæŸä¸ªæ¡ä»¶ä¹‹åï¼Œ
VnetCard é€šè¿‡ queue å‘Šè¯‰ X86 æœ‰æ–°çš„ç½‘ç»œæ•°æ®å·²ç»å‡†å¤‡å¥½ã€‚è‡³æ­¤ FPGA/ARM ç«¯
VnetCard å‘é€æ•°æ®è¿‡ç¨‹å®Œæ¯•ã€‚

###### VnetCard æ¥æ”¶æ•°æ®

VnetCard é€šè¿‡è½®è¯¢çš„æ–¹å¼è¯»å– queue ä¸­çš„ä¿¡æ¯ï¼Œä»¥ç¡®å®šæ˜¯å¦æœ‰æ–°çš„æ•°æ®åˆ°è¾¾ã€‚å¦‚æœ
queue ä¸­æœ‰æ–°æ•°æ®çš„ä¿¡æ¯ï¼ŒVnetCard å°±ä» queue ä¸­è¯»å–æ–°æ•°æ®åœ¨ FPGA/ARM ä¸­çš„
ä¿¡æ¯ï¼Œç„¶å VnetCard å°±ä» RingBuffer æŒ‡å®šçš„ä½ç½®ï¼Œå°†æ–°æ•°æ®è¿›è¡Œæ‹†åŒ…åˆ†ç¦»
æˆ TUN/TAP è¯†åˆ«çš„å¸§ï¼Œç„¶åå°†è¿™äº›å¸§é€šè¿‡ VFS æä¾›çš„ open/write æ¥å£ï¼Œå†™å…¥
åˆ° TUN/TAP åœ¨ç”¨æˆ·ç©ºé—´çš„æ¥å£ï¼Œæ­¤æ—¶ TUN/TAP é©±åŠ¨æ”¶åˆ°å†™å…¥çš„æ•°æ®ï¼Œå¹¶å°†è¿™äº›
æ•°æ®ä¼ å…¥åˆ°ç½‘ç»œåè®®å±‚ï¼Œæœ€åé€šè¿‡ Socket ä¼ é€’ç»™ç”¨æˆ·ç©ºé—´å„ç§ç½‘ç»œå·¥å…·ã€‚è‡³æ­¤
FPGA/ARM ç«¯ VnetCard æ¥æ”¶æ•°æ®è¿‡ç¨‹å®Œæ¯•ã€‚

VnetCard å®‰è£…å®Œæ¯•ä¹‹åï¼Œå¯ç”¨ä½¿ç”¨ ifconfig æŸ¥çœ‹å…¶ç½‘å¡ç›¸å…³çš„ä¿¡æ¯ï¼Œæ­¤æ—¶ï¼Œ
å¯ä»¥æŠŠ VnetCard å½“åšä¸€ä¸ªçœŸå®çš„ç½‘å¡è¿›è¡Œä½¿ç”¨ï¼Œå¦‚ä¸‹å›¾ï¼š

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000142.png)

-----------------------------------
<span id="B0"></span>

![](https://gitee.com/BiscuitOS/GIFBaseX/raw/master/RPI/IND00000B.jpg)

## VnetCard ä½¿ç”¨

Open VnetCard è™šæ‹Ÿç½‘å¡é¡¹ç›®é€šè¿‡æºç ç¼–è¯‘å®‰è£…æ–¹å¼ä½¿ç”¨ï¼Œå¼€å‘è€…å¯æŒ‰å¦‚ä¸‹æ­¥éª¤è¿›è¡Œ
ç¼–è¯‘ä½¿ç”¨ã€‚

> - [VnetCard æºç ](#B00)
>
> - [VnetCard ç¼–è¯‘](#B01)
>
> - [VnetCard è¿è¡Œ](#B02)
>
> - [VnetCard ç½‘å…³é…ç½®](#B03)

----------------------------------

#### <span id="B00">VnetCard æºç </span>

> [å®è·µæºç  VnetCard GitHub](https://github.com/WorkRoutine/VNet-Card)

å¼€å‘è€…ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å¾—ï¼š

{% highlight bash %}
git clone https://github.com/WorkRoutine/VNet-Card.git
{% endhighlight %}

--------------------------------------

#### <span id="B01">VnetCard ç¼–è¯‘</span>

ç”±äº VnetCard FGPA/ARM ç«¯ç¨‹åºæ˜¯è¦è¿è¡Œåœ¨ ARM ä¸Šçš„ï¼Œå¼€å‘è€…åº”è¯¥å‡†å¤‡å¥½
å¯¹åº”çš„äº¤å‰ç¼–è¯‘å·¥å…·ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹ Makefile èŠ‚æœ¬è¿›è¡Œé€‚é…ï¼š

{% highlight bash %}
HOST_CC=gcc
CROSS_CC=BiscuitOS/output/linux-newest-arm64/aarch64-linux-gnu/aarch64-linux-gnu/bin/aarch64-linux-gnu-gcc

## CFLAGS
CFLAGS += -I./ -lpthread

#CONFIG_ALL := -DCONFIG_SOCKET_DEBUG
SRC := main.c base.c signal.c

# CONFIG_DMA_QUEUE
#
SRC        += queue.c tap_tun.c dma.c

# CONFIG_

all: Vnet_Host Vnet_FPGA

Vnet_Host: $(SRC)
	@$(HOST_CC) $(SRC) $(CFLAGS) -DCONFIG_HOST $(CONFIG_ALL) -o $@

Vnet_FPGA: $(SRC)
	@$(CROSS_CC) $(SRC) $(CFLAGS) -DCONFIG_FPGA $(CONFIG_ALL) -o $@

clean:
	@rm -rf Vnet_*
{% endhighlight %}

åœ¨ä¸Šé¢çš„ Makefile ä¸­ï¼Œéœ€è¦ä½¿ç”¨ CROSS_CC æŒ‡å®šäº¤å‰ç¼–è¯‘å·¥å…·çš„ä½ç½®ã€‚äº¤å‰
ç¼–è¯‘å·¥å…·è®¾ç½®å®Œæ¯•ä¹‹åï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š

{% highlight bash %}
make
{% endhighlight %}

ç¼–è¯‘é€šè¿‡ä¹‹åï¼Œæºç ä¼šç”Ÿæˆä¸¤ä¸ªæ‰§è¡Œæ–‡ä»¶ "Vnet_Host" ä¸ "Vnet_FPGA"ï¼Œå…¶ä¸­
Vnet_Host æ˜¯è¿è¡Œåœ¨ X86 ç«¯çš„æ‰§è¡Œæ–‡ä»¶ï¼ŒVnet_FPGA æ˜¯è¿è¡Œåœ¨ FPGA/ARM ç«¯çš„ï¼Œ
å¼€å‘è€…éœ€è¦å°† Vnet_FPGA æ‹·è´åˆ° FPGA/ARM ä¸Šã€‚

--------------------------------------

#### <span id="B02">VnetCard è¿è¡Œ</span>

åœ¨ X86 å’Œ FPGA/ARM ä¸Šå‡†å¤‡å¥½å¯æ‰§è¡Œæ–‡ä»¶ä¹‹åï¼Œåœ¨åå°è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š

{% highlight bash %}
X86:
$> ./Vnet_Host &

FPGA/ARM:
$> ./Vnet_FPGA &
{% endhighlight %}

è¿è¡Œå®Œæ¯•ä¹‹åï¼Œä½¿ç”¨ ifconfig æŸ¥çœ‹ç½‘å¡çš„ä¿¡æ¯ï¼Œæ­¤æ—¶ç½‘å¡çš„åå­—ä¸º tun0ã€‚å¦‚ä¸‹å›¾ï¼š

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000142.png)

--------------------------------------

#### <span id="B03">VnetCard ç½‘å…³é…ç½®</span>

VnetCard æ­å»ºå¥½ä¸¤ç«¯çš„ç½‘ç»œé€šä¿¡ä¹‹åï¼Œéœ€è¦è®©ä¸¤ç«¯éƒ½èƒ½è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œ
æ­¤æ—¶ï¼Œä¸€ç«¯å­˜åœ¨ä¸å¤–ç•Œçš„è¿æ¥çš„çœŸå®ç‰©ç†ç½‘å¡ï¼Œå› æ­¤å¯ä»¥åœ¨è¯¥æ®µæ­å»ºä¸€ä¸ª
ç½‘æ¡¥æˆ– NATï¼Œä»¥æ­¤å°†å¦å¤–ä¸€ç«¯çš„ç½‘ç»œæ•°æ®åŒ…è¿›è¡Œè½¬å‘ï¼Œè¿™æ ·ä¸¤ç«¯çš„è™šæ‹Ÿç½‘å¡
å°±èƒ½ä¸å¤–éƒ¨ç½‘ç»œé€šä¿¡ã€‚å…·ä½“æ­¥éª¤å‚è€ƒå¦‚ä¸‹ï¼š

##### X86

X86 ç«¯å­˜åœ¨ä¸€ä¸ªçœŸå®çš„ç‰©ç†ç½‘å¡è¿æ¥å¤–éƒ¨ç½‘ç»œï¼Œå› æ­¤åœ¨ X86 ç«¯æ­å»ºä¸€ä¸ªç½‘æ¡¥
æˆ–è€… NATï¼Œä¸“é—¨ç”¨äºè½¬å‘ FPGA/ARM çš„ç½‘ç»œæ•°æ®åŒ…ã€‚ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼š

{% highlight bash %}
#!/bin/sh

## X86 NAT Configuration

# VnetCard name
landev=tun0
# Hardware Network Card Name
wandev=eno1
# Netmask for VnetCard
subnet=10.10.10.0/24
# Hardware Network Card IP
wanip=172.16.28.90

# NAT Configure
echo 1 > /proc/sys/net/ipv4/ip_forward
iptables -F
iptables -X
iptables -Z
iptables -t nat -A POSTROUTING -o $wandev -j MASQUERADE
{% endhighlight %}

###### FPGA/ARM

FPGA/ARM ç«¯åªå­˜åœ¨è™šæ‹Ÿç½‘å¡ï¼Œæ­¤æ—¶ FPGA/ARM å‘é€ç»™å¤–éƒ¨çš„ç½‘ç»œæ•°æ®åŒ…ï¼Œ
å…ˆç»è¿‡ VnetCard å‘é€åˆ° X86 ç«¯ï¼Œç„¶åé€šè¿‡ X86 ç«¯çš„ NAT è¿›è¡Œè½¬å‘ã€‚
FPGA/ARM ç«¯ä½¿ç”¨çš„é…ç½®å‘½ä»¤å¦‚ä¸‹ï¼š

{% highlight bash %}
route add default gw 10.10.10.1
{% endhighlight %}

é€šè¿‡ä¸Šé¢çš„å‘½ä»¤å°† FPGA/ARM çš„ç½‘å…³è®¾ç½®ä¸º X86 ç«¯ VnetCard çš„ IP åœ°å€ã€‚
ç»è¿‡ä¸Šé¢ä¸¤ç«¯çš„é…ç½®ï¼Œç°åœ¨åœ¨ FPGA/ARM ç«¯ä½¿ç”¨ ping å‘½ä»¤è®¿é—®å¤–ç½‘ï¼Œå¦‚ä¸‹å›¾ï¼š

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000191.png)

-----------------------------------
<span id="C0"></span>

![](https://gitee.com/BiscuitOS/GIFBaseX/raw/master/RPI/IND00000Q.jpg)

## VnetCard å®ç°

äº†è§£ VnetCard çš„åŸç†ä¹‹åï¼Œæœ¬èŠ‚é‡ç‚¹ä»‹ç»æŠ€æœ¯å®ç°çš„ç»†èŠ‚ã€‚é€šè¿‡æ¨¡å—åŒ–çš„ç¼–ç¨‹æ€æƒ³ï¼Œ
VnetCard è™šæ‹Ÿç½‘å¡ç”±ï¼š"Tun/Tap"ã€"DMA"ã€"Queue"ã€"RingBuffer"ã€"mmap"ã€"Signal"
å‡ ä¸ªéƒ¨åˆ†æ„æˆï¼Œæ¯ä¸ªç‹¬ç«‹æ¨¡å—æä¾›äº†å¯é çš„åŠŸèƒ½ï¼Œè®© VnetCard é¡¹ç›®æ›´åŠ ç¨³å¥å’Œå®‰å…¨ã€‚
ä¸€ä¸‹æ˜¯æ¯ä¸ªæ¨¡å—å®ç°çš„å…·ä½“ç»†èŠ‚ï¼š

> - [Tun/Tap](#C00)
>
> - [DMA](#C01)
>
> - [Queue](#C02)
>
> - [RingBuffer](#C03)
>
> - [mmap](#C04)
>
> - [Signal](#C05)

-------------------------------------

#### <span id="C00">Tun/Tap</span>

åœ¨ Linux ç½‘ç»œæ•°æ®åŒ…çš„æ¥æ”¶è¿‡ç¨‹å’Œæ•°æ®åŒ…çš„å‘é€è¿‡ç¨‹ä¸­ï¼ŒçŸ¥é“äº† Linux å†…æ ¸ä¸­æœ‰ä¸€ä¸ª
ç½‘ç»œè®¾å¤‡ç®¡ç†å±‚ï¼Œå¤„äºç½‘ç»œè®¾å¤‡é©±åŠ¨å’Œåè®®æ ˆä¹‹é—´ï¼Œè´Ÿè´£è¡”æ¥å®ƒä»¬ä¹‹é—´çš„æ•°æ®äº¤äº’ã€‚é©±åŠ¨
ä¸éœ€è¦äº†è§£åè®®æ ˆçš„ç»†èŠ‚ï¼Œåè®®æ ˆä¹Ÿä¸éœ€è¦äº†è§£è®¾å¤‡é©±åŠ¨çš„ç»†èŠ‚ã€‚

å¯¹äºä¸€ä¸ªç½‘ç»œè®¾å¤‡æ¥è¯´ï¼Œå°±åƒä¸€ä¸ªç®¡é“ (pipe) ä¸€æ ·ï¼Œæœ‰ä¸¤ç«¯ï¼Œä»å…¶ä¸­ä»»æ„ä¸€ç«¯æ”¶åˆ°çš„æ•°
æ®å°†ä»å¦ä¸€ç«¯å‘é€å‡ºå»ã€‚æ¯”å¦‚ä¸€ä¸ªç‰©ç†ç½‘å¡ eth0ï¼Œå®ƒçš„ä¸¤ç«¯åˆ†åˆ«æ˜¯å†…æ ¸åè®®æ ˆï¼ˆé€šè¿‡å†…
æ ¸ç½‘ç»œè®¾å¤‡ç®¡ç†æ¨¡å—é—´æ¥çš„é€šä¿¡ï¼‰å’Œå¤–é¢çš„ç‰©ç†ç½‘ç»œï¼Œä»ç‰©ç†ç½‘ç»œæ”¶åˆ°çš„æ•°æ®ï¼Œä¼šè½¬å‘ç»™
å†…æ ¸åè®®æ ˆï¼Œè€Œåº”ç”¨ç¨‹åºä»åè®®æ ˆå‘è¿‡æ¥çš„æ•°æ®å°†ä¼šé€šè¿‡ç‰©ç†ç½‘ç»œå‘é€å‡ºå»ã€‚

é‚£ä¹ˆå¯¹äºä¸€ä¸ªè™šæ‹Ÿç½‘ç»œè®¾å¤‡å‘¢? é¦–å…ˆå®ƒä¹Ÿå½’å†…æ ¸çš„ç½‘ç»œè®¾å¤‡ç®¡ç†å­ç³»ç»Ÿç®¡ç†ï¼Œå¯¹äº
Linux å†…æ ¸ç½‘ç»œè®¾å¤‡ç®¡ç†æ¨¡å—æ¥è¯´ï¼Œè™šæ‹Ÿè®¾å¤‡å’Œç‰©ç†è®¾å¤‡æ²¡æœ‰åŒºåˆ«ï¼Œéƒ½æ˜¯ç½‘ç»œè®¾å¤‡ï¼Œéƒ½èƒ½
é…ç½® IPï¼Œä»ç½‘ç»œè®¾å¤‡æ¥çš„æ•°æ®ï¼Œéƒ½ä¼šè½¬å‘ç»™åè®®æ ˆï¼Œåè®®æ ˆè¿‡æ¥çš„æ•°æ®ï¼Œä¹Ÿä¼šäº¤ç”±ç½‘ç»œ
è®¾å¤‡å‘é€å‡ºå»ï¼Œè‡³äºæ˜¯æ€ä¹ˆå‘é€å‡ºå»çš„ï¼Œå‘åˆ°å“ªé‡Œå»ï¼Œé‚£æ˜¯è®¾å¤‡é©±åŠ¨çš„äº‹æƒ…ï¼Œè·Ÿ Linux
å†…æ ¸å°±æ²¡å…³ç³»äº†ï¼Œæ‰€ä»¥è¯´è™šæ‹Ÿç½‘ç»œè®¾å¤‡çš„ä¸€ç«¯ä¹Ÿæ˜¯åè®®æ ˆï¼Œè€Œå¦ä¸€ç«¯æ˜¯ä»€ä¹ˆå–å†³äºè™šæ‹Ÿç½‘
ç»œè®¾å¤‡çš„é©±åŠ¨å®ç°ã€‚

å¯¹äº TUN/TAP å…ˆçœ‹ä¸€ä¸‹é€»è¾‘å…³ç³»å›¾

![](https://gitee.com/BiscuitOS/GIFBaseX/raw/master/RPI/NET000107.png)

ä¸Šå›¾ä¸­æœ‰ä¸¤ä¸ªåº”ç”¨ç¨‹åº A å’Œ Bï¼Œéƒ½åœ¨ç”¨æˆ·å±‚ï¼Œè€Œå…¶å®ƒçš„ socketã€åè®®æ ˆï¼ˆNewwork
Protocol Stackï¼‰å’Œç½‘ç»œè®¾å¤‡ï¼ˆeth0 å’Œ tun0ï¼‰éƒ¨åˆ†éƒ½åœ¨å†…æ ¸å±‚ï¼Œå…¶å® socket æ˜¯åè®®
æ ˆçš„ä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œåˆ†å¼€æ¥çš„ç›®çš„æ˜¯ä¸ºäº†çœ‹çš„æ›´ç›´è§‚ã€‚

tun0 æ˜¯ä¸€ä¸ª Tun/Tap è™šæ‹Ÿè®¾å¤‡ï¼Œä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºå®ƒå’Œç‰©ç†è®¾å¤‡eth0çš„å·®åˆ«ï¼Œå®ƒä»¬çš„ä¸€
ç«¯è™½ç„¶éƒ½è¿ç€åè®®æ ˆï¼Œä½†å¦ä¸€ç«¯ä¸ä¸€æ ·ï¼Œeth0 çš„å¦ä¸€ç«¯æ˜¯ç‰©ç†ç½‘ç»œï¼Œè¿™ä¸ªç‰©ç†ç½‘ç»œå¯èƒ½
å°±æ˜¯ä¸€ä¸ªäº¤æ¢æœºï¼Œè€Œ tun0 çš„å¦ä¸€ç«¯æ˜¯ä¸€ä¸ªç”¨æˆ·å±‚çš„ç¨‹åºï¼Œåè®®æ ˆå‘ç»™tun0çš„æ•°æ®åŒ…èƒ½è¢«
è¿™ä¸ªåº”ç”¨ç¨‹åºè¯»å–åˆ°ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºèƒ½ç›´æ¥å‘ tun0 å†™æ•°æ®ã€‚è¿™é‡Œå‡è®¾ eth0 é…ç½®çš„IPæ˜¯
10.32.0.11ï¼Œè€Œ tun0 é…ç½®çš„ IP æ˜¯ 192.168.3.11.

è¿™é‡Œåˆ—ä¸¾çš„æ˜¯ä¸€ä¸ªå…¸å‹çš„ tun/tap è®¾å¤‡çš„åº”ç”¨åœºæ™¯ï¼Œå‘åˆ° 192.168.3.0/24 ç½‘ç»œçš„æ•°æ®
é€šè¿‡ç¨‹åºBè¿™ä¸ªéš§é“ï¼Œåˆ©ç”¨ 10.32.0.11 å‘åˆ°è¿œç«¯ç½‘ç»œçš„ 10.33.0.1ï¼Œå†ç”± 10.33.0.1 è½¬
å‘ç»™ç›¸åº”çš„è®¾å¤‡ï¼Œä»è€Œå®ç° VPNã€‚

ä¸‹é¢æ¥çœ‹çœ‹æ•°æ®åŒ…çš„æµç¨‹ï¼š

> 1. åº”ç”¨ç¨‹åºAæ˜¯ä¸€ä¸ªæ™®é€šçš„ç¨‹åºï¼Œé€šè¿‡ socket A å‘é€äº†ä¸€ä¸ªæ•°æ®åŒ…ï¼Œå‡è®¾è¿™ä¸ªæ•°æ®åŒ…
>    çš„ç›®çš„ IP åœ°å€æ˜¯ 192.168.3.1
>
> 2. socket å°†è¿™ä¸ªæ•°æ®åŒ…ä¸¢ç»™åè®®æ ˆ
>
> 3. åè®®æ ˆæ ¹æ®æ•°æ®åŒ…çš„ç›®çš„IPåœ°å€ï¼ŒåŒ¹é…æœ¬åœ°è·¯ç”±è§„åˆ™ï¼ŒçŸ¥é“è¿™ä¸ªæ•°æ®åŒ…åº”è¯¥ç”±
>    tun0 å‡ºå»ï¼Œäºæ˜¯å°†æ•°æ®åŒ…äº¤ç»™ tun0
>
> 4. tun0 æ”¶åˆ°æ•°æ®åŒ…ä¹‹åï¼Œå‘ç°å¦ä¸€ç«¯è¢«è¿›ç¨‹ B æ‰“å¼€äº†ï¼Œäºæ˜¯å°†æ•°æ®åŒ…ä¸¢ç»™äº†è¿›ç¨‹ B
>
> 5. è¿›ç¨‹ B æ”¶åˆ°æ•°æ®åŒ…ä¹‹åï¼Œåšä¸€äº›è·Ÿä¸šåŠ¡ç›¸å…³çš„å¤„ç†ï¼Œç„¶åæ„é€ ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…ï¼Œå°†åŸ
>    æ¥çš„æ•°æ®åŒ…åµŒå…¥åœ¨æ–°çš„æ•°æ®åŒ…ä¸­ï¼Œæœ€åé€šè¿‡socket B å°†æ•°æ®åŒ…è½¬å‘å‡ºå»ï¼Œè¿™æ—¶å€™æ–°æ•°
>    æ®åŒ…çš„æºåœ°å€å˜æˆäº†eth0 çš„åœ°å€ï¼Œè€Œç›®çš„IPåœ°å€å˜æˆäº†ä¸€ä¸ªå…¶å®ƒçš„åœ°å€ï¼Œæ¯”å¦‚æ˜¯
>    10.33.0.1.
>
> 6. socket B å°†æ•°æ®åŒ…ä¸¢ç»™åè®®æ ˆ
>
> 7. åè®®æ ˆæ ¹æ®æœ¬åœ°è·¯ç”±ï¼Œå‘ç°è¿™ä¸ªæ•°æ®åŒ…åº”è¯¥è¦é€šè¿‡ eth0 å‘é€å‡ºå»ï¼Œäºæ˜¯å°†æ•°æ®åŒ…äº¤
>    ç»™ eth0
>
> 8. eth0 é€šè¿‡ç‰©ç†ç½‘ç»œå°†æ•°æ®åŒ…å‘é€å‡ºå»
>
> 9. 10.33.0.1 æ”¶åˆ°æ•°æ®åŒ…ä¹‹åï¼Œä¼šæ‰“å¼€æ•°æ®åŒ…ï¼Œè¯»å–é‡Œé¢çš„åŸå§‹æ•°æ®åŒ…ï¼Œå¹¶è½¬å‘ç»™æœ¬
>    åœ°çš„ 192.168.3.1ï¼Œç„¶åç­‰æ”¶åˆ° 192.168.3.1 çš„åº”ç­”åï¼Œå†æ„é€ æ–°çš„åº”ç­”åŒ…ï¼Œå¹¶å°†
>    åŸå§‹åº”ç­”åŒ…å°è£…åœ¨é‡Œé¢ï¼Œå†ç”±åŸè·¯å¾„è¿”å›ç»™åº”ç”¨ç¨‹åº Bï¼Œåº”ç”¨ç¨‹åº B å–å‡ºé‡Œé¢çš„åŸ
>    å§‹åº”ç­”åŒ…ï¼Œæœ€åè¿”å›ç»™åº”ç”¨ç¨‹åº A

è¿™é‡Œä¸è®¨è®º Tun/Tap è®¾å¤‡ tun0 æ˜¯æ€ä¹ˆå’Œç”¨æˆ·å±‚çš„è¿›ç¨‹ B è¿›è¡Œé€šä¿¡çš„ï¼Œå¯¹äº Linux å†…
æ ¸æ¥è¯´ï¼Œæœ‰å¾ˆå¤šç§åŠæ³•æ¥è®©å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´çš„è¿›ç¨‹äº¤æ¢æ•°æ®ã€‚ä»ä¸Šé¢çš„æµç¨‹ä¸­å¯ä»¥çœ‹
å‡ºï¼Œæ•°æ®åŒ…é€‰æ‹©èµ°å“ªä¸ªç½‘ç»œè®¾å¤‡å®Œå…¨ç”±è·¯ç”±è¡¨æ§åˆ¶ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è®©æŸäº›ç½‘ç»œæµé‡èµ°åº”
ç”¨ç¨‹åº B çš„è½¬å‘æµç¨‹ï¼Œå°±éœ€è¦é…ç½®è·¯ç”±è¡¨è®©è¿™éƒ¨åˆ†æ•°æ®èµ° tun0ã€‚

> - [Tun/Tap ä½¿ç”¨å®ä¾‹](https://github.com/BiscuitOS/HardStack/tree/master/bus/net/tun/app)
>
> - [Tun/Tap on VnetCard](https://github.com/WorkRoutine/VNet-Card/blob/master/tap_tun.c)


-------------------------------------

#### <span id="C01">DMA</span>

DMA æ˜¯ä¸€ç§ä¸ç»è¿‡ CPU è€Œç›´æ¥ä»å†…å­˜å­˜å–æ•°æ®çš„æ•°æ®äº¤æ¢æ¨¡å¼ã€‚åœ¨ DMA æ¨¡å¼ä¸‹ï¼ŒCPU
åªé¡»å‘ DMA æ§åˆ¶å™¨ä¸‹è¾¾æŒ‡ä»¤ï¼Œè®© DMA æ§åˆ¶å™¨æ¥å¤„ç†æ•°æ®çš„ä¼ é€ï¼Œæ•°æ®ä¼ é€å®Œæ¯•å†æŠŠä¿¡
æ¯åé¦ˆç»™ CPUï¼Œè¿™æ ·å°±å¾ˆå¤§ç¨‹åº¦ä¸Šå‡è½»äº† CPU èµ„æºå æœ‰ç‡ï¼Œå¯ä»¥å¤§å¤§èŠ‚çœç³»ç»Ÿèµ„æºã€‚
DMA æ¨¡å¼åˆå¯ä»¥åˆ†ä¸º Single-Word DMAï¼ˆå•å­—èŠ‚DMAï¼‰å’Œ Multi-Word DMAï¼ˆå¤šå­—èŠ‚
DMAï¼‰ä¸¤ç§ï¼Œå…¶ä¸­æ‰€èƒ½è¾¾åˆ°çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ä¹Ÿåªæœ‰16.6MB/sã€‚

åœ¨ VnetCard è™šæ‹Ÿç½‘å¡é¡¹ç›®ä¸­ï¼ŒDMA ç›¸å…³çš„æ“ä½œä½äº dma.c ä¸­ï¼Œå…¶å·¥ä½œåœ¨ X86 ç«¯ï¼Œ
èµ‹å€¼ X86 ç«¯ç‰©ç†å†…å­˜æ•°æ®å’Œ FPGA/ARM ç‰©ç†å†…å­˜æ•°æ®çš„äº¤æ¢ã€‚dma.c æä¾›äº†ç®€ä¾¿çš„
æ¥å£ï¼Œç”¨äº DMA çš„ read/write æ“ä½œã€‚å…¶ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒä¸‹é¢æ–‡ä»¶ï¼š

> [DMA userspace API](https://github.com/WorkRoutine/VNet-Card/blob/master/dma.c)

-------------------------------------

#### <span id="C02">Queue</span>

Quene æ˜¯ä¸€ä¸ªåŸºäº PCIe çš„ 32bit ç¡¬ä»¶é˜Ÿåˆ—ï¼ŒVnetCard è™šæ‹Ÿç½‘å¡ä½¿ç”¨ Queue é˜Ÿåˆ—
çš„æ€§è´¨ï¼Œç”¨äºä¼ é€’æ•°æ®å—åŸºæœ¬ä¿¡æ¯ã€‚è™šæ‹Ÿç½‘å¡åœ¨ä½¿ç”¨ DMA ä¼ é€’å¤§å—æ•°æ®ä¹‹åï¼Œéƒ½ä¼šä½¿ç”¨
queue é€šçŸ¥å¯¹æ–¹ï¼›è™šæ‹Ÿç½‘å¡ä¹Ÿé€šè¿‡æŸ¥è¯¢ queue é‡Œé¢çš„æ¶ˆæ¯ï¼Œä»¥æ­¤ç¡®å®šæ˜¯å¦æœ‰æ–°çš„æ•°æ®
åˆ°è¾¾ï¼Œè¿™æ ·å°±å®ç°äº†å¤š CPU ä¹‹é—´çš„å¼‚æ­¥é€šçŸ¥æœºåˆ¶ã€‚

VnetCard ä¹Ÿå¯¹ queue çš„ä¿¡æ¯å¸§å®è¡Œçš„ç¼–ç ï¼Œç¼–ç æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œåˆ†è´å¦‚ä¸‹ï¼š

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000143.png)

ä¸¤ç§æ–¹æ¡ˆéƒ½å¯è¡Œï¼Œå…·ä½“ä½¿ç”¨å“ªç§ä¾å®è·µæƒ…å†µè€Œå®šï¼Œqueue çš„åŸºæœ¬æ€è·¯éƒ½æ˜¯ä»
queue é˜Ÿåˆ—ä¸­è¯»å– 32bitï¼Œç„¶ååˆ¤æ–­è¿™ä¸ª 32bit çš„ Magic æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œ
å¦‚æœä¸ç¬¦åˆè¦æ±‚ï¼Œé‚£ä¹ˆä¸¢å¼ƒè¯¥å¸§ï¼Œç»§ç»­è¯»å–ä¸‹ä¸€å¸§ï¼›å¦‚æœ Magic ç¬¦åˆè¦æ±‚ï¼Œ
é‚£ä¹ˆç»§ç»­ä» queue ä¸­è¯»å– Ringbuffer indexï¼Œå³æ–°æ•°æ®ä½äº Ringbuffer
çš„ä½ç½®ï¼Œæ¥ç€ä¹Ÿä» queue ä¸­è·å¾—è¯¥ buffer ä¸­ä¸€å…±å«æœ‰å¤šå°‘ä¸ªç½‘ç»œå¸§ã€‚VnetCard
ä» queue é‡Œé¢è·å¾—è¿™äº›æ•°æ®ä¹‹åï¼Œé€šçŸ¥å¯¹æ–¹ CPUï¼Œä»¥æ­¤å®ç°å¤š CPU å¼‚æ­¥é€šçŸ¥
æœºåˆ¶ã€‚VnetCard è™šæ‹Ÿç½‘å¡ä¸­ï¼Œqueue çš„å®ç°è¿‡ç¨‹è¯·çœ‹ä¸‹é¢é“¾æ¥ï¼š

> [Queue exchange frame message](https://github.com/WorkRoutine/VNet-Card/blob/master/queue.c)

-------------------------------------

#### <span id="C03">RingBuffer</span>

VnetCard æä¾›äº†ä¸€ä¸ª Ringbuffer ç”¨äºå­˜å‚¨ç½‘ç»œæ•°æ®ï¼ŒRingbuffer è¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œ
ç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å‘é€çš„ç½‘ç»œæ•°æ®ï¼Œç¬¬äºŒéƒ¨åˆ†ç”¨äºå­˜å‚¨æ¥æ”¶çš„ç½‘ç»œæ•°æ®ã€‚æ¯éƒ¨åˆ†åˆè¢«æ‹†åˆ†
æˆæ›´å°çš„æ•°æ®å—ï¼Œç”¨äº DMA çš„ç›´æ¥ä¼ é€ã€‚å¦‚ä¸‹å›¾ï¼š

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000144.png)

###### Send Frame Buffer

Send Frame Buffer ç”¨äºå­˜å‚¨ä» Tun/Tap è™šæ‹Ÿç½‘å¡è·å¾—çš„ç½‘ç»œå¸§ï¼ŒVnetCard å°†
è¿™äº›ç½‘ç»œå¸§è¿›è¡Œå°åŒ…ï¼Œå°åŒ…ä¹‹åå†å°†åŒ…æ‹¼åˆ° RingBuffer çš„ä¸€å—å†…å­˜é‡Œã€‚æ¯å½“ç¬¦åˆ
ç‰¹å®šæ¡ä»¶æ—¶ï¼ŒVnetCard è™šæ‹Ÿç½‘å¡å°±å°†æ‹¼å¥½çš„å†…å­˜é€šè¿‡ DMA å‘é€åˆ°å¯¹ç«¯çš„å†…å­˜ä¸Šã€‚

###### Receive Frame Buffer

Receive Frame Buffer ç”¨äºä»å¯¹ç«¯å†…å­˜ä¸­ï¼Œé€šè¿‡ DMA æ‹·è´è¿‡æ¥çš„æ•°æ®å—ï¼Œæ•°æ®
å—é‡Œé¢éƒ½æ˜¯æ‹¼å·çš„å¸§ã€‚

RingBuffer é€šè¿‡è¿ç»­ä¸æ–­çš„å°†æ•°æ®å¸§æ‹¼è£…åˆ° Buffer é‡Œé¢ï¼Œç„¶åç­‰å¾…æ—¶æœºæˆç†Ÿ
è¿›è¡Œå‘é€ï¼Œç„¶ååˆå¾ªç¯åˆ°ä¸‹ä¸€å— Buffer ç»§ç»­æ‹¼æ•°æ®åŒ…ï¼Œå½“å¾ªç¯åˆ°æœ€åä¸€å—æ•°æ®
å—ä¹‹åï¼ŒRingBuffer æœ‰è·³è½¬åˆ°ç¬¬ä¸€å—ç»§ç»­å¾ªç¯ã€‚

###### å°åŒ…

VnetCard è™šæ‹Ÿç½‘å¡é€šè¿‡ç‰¹å®šçš„è§„åˆ™å°†æ•°æ®å¸§å°åŒ…æ‹¼è£…åˆ° Buffer é‡Œé¢ï¼Œå°åŒ…çš„
æ–¹æ¡ˆæœ‰å¾ˆå¤šç§ï¼Œç›®å‰ä½¿ç”¨çš„æ˜¯ä¸‹å›¾çš„æ–¹æ¡ˆï¼š

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000145.png)

å°åŒ…çš„è¿‡ç¨‹å¾ˆç®€çº¦ï¼Œé¦–å…ˆåœ¨åŒ…å¤´å†™å…¥ Frame Magic ä¿¡æ¯ï¼Œç„¶åå†™å…¥æ•°æ®åŒ…çš„é•¿åº¦ï¼Œ
åé¢ç´§è·Ÿç€å°±æ˜¯æ•°æ®ï¼Œæœ€åæ¯ä¸ªåŒ…éƒ½æ˜¯æŒ‰ 4 å­—èŠ‚å¯¹é½ï¼Œä»¥æé«˜æ•ˆç‡ã€‚VnetCard
è™šæ‹Ÿç½‘å¡ä¸­ï¼Œå°åŒ…ç›¸å…³çš„å‡½æ•°ä½äº dma.c ä¸­ï¼Œå…¶ä½¿ç”¨ `dma_buffer_fill()` å‡½æ•°ã€‚

###### æ‹†åŒ…

VnetCard è™šæ‹Ÿç½‘å¡ä»å¯¹ç«¯æ¥æ”¶æ•°æ®å—ä¹‹åï¼Œéœ€è¦å°†æ•°æ®å—æ‹†æˆ TUN/TAP æ‰€
è¯†åˆ«çš„å¸§ï¼Œæ‹†åŒ…çš„é€»è¾‘å’Œå°åŒ…ç›¸åï¼Œé¦–å…ˆ VnetCard ä» Buffer å¼€å§‹æŸ¥æ‰¾ç¬¬ä¸€ä¸ª
ç¬¦åˆ Frame Magic çš„ä½ç½®ï¼Œç„¶åä»ä¸­è¯»åˆ°å¸§é•¿åº¦ï¼Œå¹¶ä»ä¸­å·®åˆ†å¤„æ•°æ®å¸§åˆ°æŒ‡å®š
ä½ç½®ï¼Œç„¶ååˆæŸ¥æ‰¾ä¸‹ä¸€ä¸ªç¬¦åˆ Frame Magic çš„ä½ç½®ï¼Œä¾æ¬¡å°†æ•°æ®å¸§è§£æå®Œã€‚
æ‹†åŒ…çš„å‡½æ•°ä½äº dma.c ä¸­ï¼Œå…¶ä½¿ç”¨ `dma_buffer_split()` å‡½æ•°ã€‚

-------------------------------------

#### <span id="C04">mmap</span>

mmap ä¸»è¦ç”¨äºå°†ç‰©ç†åœ°å€æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ï¼Œåœ¨ VnetCard ä¸­ä¸ºäº†åŠ é€Ÿå¯¹ç‰©ç†åœ°å€çš„
èŒƒå›´ï¼Œå°† FPGA/ARM çš„å…±äº«å†…å­˜æ˜ å°„åˆ° VnetCard çš„è™šæ‹Ÿç©ºé—´ï¼Œè¿™å¤§å¤§æ–¹é¢çš„æ•°æ®
çš„è¯»å–å’Œäº¤äº’ã€‚

-------------------------------------

#### <span id="C05">Signal</span>

VnetCard è™šæ‹Ÿç½‘å¡å¢åŠ äº†å¯¹ä¿¡å·çš„å¤„ç†ï¼Œä»¥é˜²æ­¢åœ¨ç‰¹æ®Šæƒ…å†µä¸‹è™šæ‹Ÿç½‘å¡éƒ¨åˆ†åŠŸèƒ½å‡ºé”™
çš„æƒ…å†µä¸‹ï¼Œå…¶ä»–åŠŸèƒ½èƒ½å¤Ÿå®‰å…¨çš„é€€å‡ºã€‚ç›¸å…³çš„ä»£ç è¯·çœ‹ä¸‹é¢ï¼š

> - [VnetCard è™šæ‹Ÿç½‘å¡ä¿¡å·å¤„ç†](https://github.com/WorkRoutine/VNet-Card/blob/master/signal.c)

-----------------------------------
<span id="D0"></span>

![](https://gitee.com/BiscuitOS/GIFBaseX/raw/master/RPI/IND00000E.jpg)

## VnetCard æµ‹è¯•

VnetCard è™šæ‹Ÿç½‘å¡å¯ä»¥ä½¿ç”¨é€šç”¨çš„ç½‘ç»œå·¥å…·è¿›è¡Œæµ‹è¯•ï¼Œä¸‹é¢å°±ä½¿ç”¨é€šè¿‡
çš„å·¥å…·è¿›è¡Œæµ‹è¯•ï¼š

> - [ping](#D00)
>
> - [ssh](#D01)
>
> - [scp](#D02)
>
> - [iperf TCP](#D03)
>
> - [iperf UDP](#D04)
>
> - [socket](#D05)

-------------------------------------

#### <span id="D00">ping</span>

ping ä½œä¸ºæœ€åŸºç¡€çš„æµ‹è¯•ï¼Œç”¨äºæµ‹è¯•ç½‘ç»œçš„è¿é€šæ€§ï¼Œä¸¢åŒ…ç‡æµ‹è¯•ï¼Œä¸‹é¢å°†
å¯¹ VnetCard è™šæ‹Ÿç½‘å¡ä½¿ç”¨ä¸åŒçš„æµ‹è¯•ç”¨ä¾‹ã€‚X64 ç«¯ IP: 10.10.10.1ã€‚
FGPA/ARM ç«¯ IP: 10.10.10.5ã€‚

> - [åŸºç¡€ ping æµ‹è¯•](#D000)
>
> - [1024 Byte](#D001)
>
> - [8192 Byte](#D002)
>
> - [10240 Byte](#D003)
>
> - [20480 Byte](#D004)
>
> - [è¶…çº§å¤§åŒ…é•¿æ—¶é—´ ping æµ‹è¯•](#D005)
>
> - [è¶…çº§å°åŒ…é•¿æ—¶é—´ ping æµ‹è¯•](#D006)

----------------------------

###### <span id="D000">åŸºç¡€ ping æµ‹è¯•</span>

æµ‹è¯•å‘½ä»¤ï¼š

{% highlight bash %}
ping 10.10.10.5 -c 11
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000146.png)

X86 ç«¯ä½¿ç”¨ ping å‘½ä»¤ï¼Œä¸¢åŒ…ç‡ä¸º 0%ï¼Œå¹³å‡æ¯æ¬¡ ping è€—æ—¶ 2.004 æ¯«ç§’ã€‚

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000147.png)

FPGA/ARM æ®µä½¿ç”¨ ping å‘½ä»¤ï¼Œä¸¢åŒ…ç‡ 0%ï¼Œå¹³å‡æ¯æ¬¡ ping è€—æ—¶ 2.663 æ¯«ç§’ã€‚

-----------------------------------

###### <span id="D001">1024 Byte</span>

æ¯ä¸ª ping åŒ…å¤§å° 1024 ä¸ªå­—èŠ‚ï¼Œæµ‹è¯•å‘½ä»¤ï¼š

{% highlight bash %}
ping 10.10.10.5 -c 11 -s 1024
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000148.png)

X86 ç«¯ä½¿ç”¨ ping å‘½ä»¤ï¼Œæ¯æ¬¡ 1024 å­—èŠ‚æ•°æ®ï¼Œä¸¢åŒ…ç‡ä¸º 0%ï¼Œå¹³å‡æ¯æ¬¡ ping
è€—æ—¶ 2.164 æ¯«ç§’ã€‚

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000149.png)

FPGA/ARM æ®µä½¿ç”¨ ping å‘½ä»¤ï¼Œæ¯æ¬¡ 1024 å­—èŠ‚æ•°æ®ï¼Œä¸¢åŒ…ç‡ 0%ï¼Œå¹³å‡æ¯æ¬¡
ping è€—æ—¶ 1.892 æ¯«ç§’ã€‚

-----------------------------------

###### <span id="D002">8192 Byte</span>

æ¯ä¸ª ping åŒ…å¤§å° 8192 ä¸ªå­—èŠ‚ï¼Œæµ‹è¯•å‘½ä»¤ï¼š

{% highlight bash %}
ping 10.10.10.5 -c 11 -s 8192
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000150.png)

X86 ç«¯ä½¿ç”¨ ping å‘½ä»¤ï¼Œæ¯æ¬¡ 8192 å­—èŠ‚æ•°æ®ï¼Œä¸¢åŒ…ç‡ä¸º 0%ï¼Œå¹³å‡æ¯æ¬¡ ping
è€—æ—¶ 2.059 æ¯«ç§’ã€‚

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000151.png)

FPGA/ARM æ®µä½¿ç”¨ ping å‘½ä»¤ï¼Œæ¯æ¬¡ 8192 å­—èŠ‚æ•°æ®ï¼Œä¸¢åŒ…ç‡ 0%ï¼Œå¹³å‡æ¯æ¬¡
ping è€—æ—¶ 2.281 æ¯«ç§’ã€‚

------------------------------

###### <span id="D003">10240 Byte</span>

æ¯ä¸ª ping åŒ…å¤§å° 10240 ä¸ªå­—èŠ‚ï¼Œæµ‹è¯•å‘½ä»¤ï¼š

{% highlight bash %}
ping 10.10.10.5 -c 11 -s 10240
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000152.png)

X86 ç«¯ä½¿ç”¨ ping å‘½ä»¤ï¼Œæ¯æ¬¡ 10240 å­—èŠ‚æ•°æ®ï¼Œä¸¢åŒ…ç‡ä¸º 0%ï¼Œå¹³å‡æ¯æ¬¡ ping
è€—æ—¶ 2.156 æ¯«ç§’ã€‚

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000153.png)

FPGA/ARM æ®µä½¿ç”¨ ping å‘½ä»¤ï¼Œæ¯æ¬¡ 10240 å­—èŠ‚æ•°æ®ï¼Œä¸¢åŒ…ç‡ 0%ï¼Œå¹³å‡æ¯æ¬¡
ping è€—æ—¶ 2.215 æ¯«ç§’ã€‚

----------------------------------

###### <span id="D004">20480 Byte</span>

æ¯ä¸ª ping åŒ…å¤§å° 20480 ä¸ªå­—èŠ‚ï¼Œæµ‹è¯•å‘½ä»¤ï¼š

{% highlight bash %}
ping 10.10.10.5 -c 11 -s 20480
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000154.png)

X86 ç«¯ä½¿ç”¨ ping å‘½ä»¤ï¼Œæ¯æ¬¡ 20480 å­—èŠ‚æ•°æ®ï¼Œä¸¢åŒ…ç‡ä¸º 0%ï¼Œå¹³å‡æ¯æ¬¡ ping
è€—æ—¶ 2.767 æ¯«ç§’ã€‚

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000155.png)

FPGA/ARM æ®µä½¿ç”¨ ping å‘½ä»¤ï¼Œæ¯æ¬¡ 20480 å­—èŠ‚æ•°æ®ï¼Œä¸¢åŒ…ç‡ 0%ï¼Œå¹³å‡æ¯æ¬¡
ping è€—æ—¶ 2.902 æ¯«ç§’ã€‚

--------------------------------------

###### <span id="D005">è¶…çº§å¤§åŒ…é•¿æ—¶é—´ ping æµ‹è¯•</span>

æ¯ä¸ª ping åŒ…å¤§å° 20480 ä¸ªå­—èŠ‚ï¼Œæµ‹è¯• 10 min æµ‹è¯•å‘½ä»¤ï¼š

{% highlight bash %}
ping 10.10.10.5 -c 600 -s 20480 -i 1
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000156.png)

X86 ç«¯ä½¿ç”¨ ping å‘½ä»¤ï¼Œæ¯æ¬¡ 20480 å­—èŠ‚æ•°æ®ï¼Œä¸¢åŒ…ç‡ä¸º 0%ï¼Œå¹³å‡æ¯æ¬¡ ping
è€—æ—¶ 2.488 æ¯«ç§’ã€‚600 æ¬¡æ³¢å½¢å›¾å¦‚ä¸‹ï¼š

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000157.png)

###### è¶…çº§å°åŒ…é•¿æ—¶é—´ ping æµ‹è¯•

æ¯ä¸ª ping åŒ…å¤§å° 20 ä¸ªå­—èŠ‚ï¼Œæµ‹è¯• 10 min æµ‹è¯•å‘½ä»¤ï¼š

{% highlight bash %}
ping 10.10.10.5 -c 600 -s 20 -i 1
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000158.png)

X86 ç«¯ä½¿ç”¨ ping å‘½ä»¤ï¼Œæ¯æ¬¡ 20480 å­—èŠ‚æ•°æ®ï¼Œä¸¢åŒ…ç‡ä¸º 0%ï¼Œå¹³å‡æ¯æ¬¡ ping
è€—æ—¶ 2.062 æ¯«ç§’ã€‚600 æ¬¡æ³¢å½¢å›¾å¦‚ä¸‹ï¼š

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000159.png)

-------------------------------------

#### <span id="D01">ssh</span>

SSH ä¸º Secure Shell çš„ç¼©å†™ï¼Œç”± IETF çš„ç½‘ç»œå°ç»„ï¼ˆNetwork Working Groupï¼‰æ‰€
åˆ¶å®šï¼›SSH ä¸ºå»ºç«‹åœ¨åº”ç”¨å±‚åŸºç¡€ä¸Šçš„å®‰å…¨åè®®ã€‚SSH æ˜¯ç›®å‰è¾ƒå¯é ï¼Œä¸“ä¸ºè¿œç¨‹ç™»å½•ä¼šè¯å’Œ
å…¶ä»–ç½‘ç»œæœåŠ¡æä¾›å®‰å…¨æ€§çš„åè®®ã€‚åˆ©ç”¨ SSH åè®®å¯ä»¥æœ‰æ•ˆé˜²æ­¢è¿œç¨‹ç®¡ç†è¿‡ç¨‹ä¸­çš„ä¿¡æ¯æ³„
éœ²é—®é¢˜ã€‚SSH æœ€åˆæ˜¯ UNIX ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªç¨‹åºï¼Œåæ¥åˆè¿…é€Ÿæ‰©å±•åˆ°å…¶ä»–æ“ä½œå¹³å°ã€‚SSH åœ¨
æ­£ç¡®ä½¿ç”¨æ—¶å¯å¼¥è¡¥ç½‘ç»œä¸­çš„æ¼æ´ã€‚SSH å®¢æˆ·ç«¯é€‚ç”¨äºå¤šç§å¹³å°ã€‚å‡ ä¹æ‰€æœ‰UNIXå¹³å°â€”åŒ…æ‹¬
HP-UXã€Linuxã€AIXã€Solarisã€Digital UNIXã€Irixï¼Œä»¥åŠå…¶ä»–å¹³å°ï¼Œéƒ½å¯è¿è¡Œ SSHã€‚

X86 ç«¯ä½¿ç”¨ SSH ç™»å½•å¯¹ç«¯ï¼Œä½¿ç”¨å‘½ä»¤ï¼š

{% highlight bash %}
ssh root@10.10.10.10.5
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000160.png)

FPGA/ARM ç«¯ä½¿ç”¨ SSH ç™»å½•å¯¹ç«¯ï¼Œä½¿ç”¨å‘½ä»¤ï¼š

{% highlight bash %}
ssh test@10.10.10.10.1
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000161.png)

-------------------------------------

#### <span id="D02">scp</span>

scp æ˜¯ secure copy çš„ç®€å†™ï¼Œç”¨äºåœ¨ Linux ä¸‹è¿›è¡Œè¿œç¨‹æ‹·è´æ–‡ä»¶çš„å‘½ä»¤ï¼Œå’Œå®ƒç±»ä¼¼
çš„å‘½ä»¤æœ‰ cpï¼Œä¸è¿‡ cp åªæ˜¯åœ¨æœ¬æœºè¿›è¡Œæ‹·è´ä¸èƒ½è·¨æœåŠ¡å™¨ï¼Œè€Œä¸” scp ä¼ è¾“æ˜¯åŠ å¯†çš„ã€‚
å¯èƒ½ä¼šç¨å¾®å½±å“ä¸€ä¸‹é€Ÿåº¦ã€‚å½“ä½ æœåŠ¡å™¨ç¡¬ç›˜å˜ä¸ºåªè¯» read only system æ—¶ï¼Œç”¨ scp
å¯ä»¥å¸®ä½ æŠŠæ–‡ä»¶ç§»å‡ºæ¥ã€‚å¦å¤–ï¼Œscp è¿˜éå¸¸ä¸å èµ„æºï¼Œä¸ä¼šæé«˜å¤šå°‘ç³»ç»Ÿè´Ÿè·ï¼Œåœ¨è¿™ä¸€
ç‚¹ä¸Šï¼Œrsync å°±è¿œè¿œä¸åŠå®ƒäº†ã€‚è™½ç„¶ rsync æ¯” scp ä¼šå¿«ä¸€ç‚¹ï¼Œä½†å½“å°æ–‡ä»¶ä¼—å¤šçš„æƒ…
å†µä¸‹ï¼Œrsync ä¼šå¯¼è‡´ç¡¬ç›˜I/Oéå¸¸é«˜ï¼Œè€Œ scp åŸºæœ¬ä¸å½±å“ç³»ç»Ÿæ­£å¸¸ä½¿ç”¨ã€‚

æœ¬æœºä½¿ç”¨ scp æ‹·è´æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•å¦‚ä¸‹ï¼šX86 ç«¯çš„ IPï¼š10.10.10.1ï¼Œ
FPGA/ARM ç«¯çš„ IPï¼š10.10.10.5

> - [1M](#D020)
>
> - [10M](#D021)
>
> - [50M](#D022)
>
> - [100M](#D023)
>
> - [200M](#D024)
>
> - [20 æ¬¡ 200M](#D025)

-------------------------------

### <span id="D020">1M</span>

ä½¿ç”¨ scp æ‹·è´ 1M çš„æ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤ï¼š

{% highlight bash %}
scp M.img root@10.10.10.5:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000162.png)

X86 ç«¯æ‹·è´é€Ÿåº¦ä¸ºï¼š1MB/s

{% highlight bash %}
scp M.img test@10.10.10.1:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000163.png)

FPGA/ARM ç«¯æ‹·è´é€Ÿåº¦ä¸ºï¼š1MB/s

-------------------------------

### <span id="D021">10M</span>

ä½¿ç”¨ scp æ‹·è´ 10M çš„æ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤ï¼š

{% highlight bash %}
scp M.img root@10.10.10.5:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000164.png)

X86 ç«¯æ‹·è´é€Ÿåº¦ä¸ºï¼š10MB/s

{% highlight bash %}
scp M.img test@10.10.10.1:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000165.png)

FPGA/ARM ç«¯æ‹·è´é€Ÿåº¦ä¸ºï¼š5MB/s

-------------------------------

### <span id="D022">50M</span>

ä½¿ç”¨ scp æ‹·è´ 50M çš„æ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤ï¼š

{% highlight bash %}
scp M.img root@10.10.10.5:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000166.png)

X86 ç«¯æ‹·è´é€Ÿåº¦ä¸ºï¼š8.3MB/s

{% highlight bash %}
scp M.img test@10.10.10.1:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000167.png)

FPGA/ARM ç«¯æ‹·è´é€Ÿåº¦ä¸ºï¼š7.1MB/s

-------------------------------

### <span id="D023">100M</span>

ä½¿ç”¨ scp æ‹·è´ 100M çš„æ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤ï¼š

{% highlight bash %}
scp M.img root@10.10.10.5:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000168.png)

X86 ç«¯æ‹·è´é€Ÿåº¦ä¸ºï¼š7.7MB/s

{% highlight bash %}
scp M.img test@10.10.10.1:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000169.png)

FPGA/ARM ç«¯æ‹·è´é€Ÿåº¦ä¸ºï¼š5.6MB/s

-------------------------------

### <span id="D024">200M</span>

ä½¿ç”¨ scp æ‹·è´ 200M çš„æ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤ï¼š

{% highlight bash %}
scp M.img root@10.10.10.5:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000170.png)

X86 ç«¯æ‹·è´é€Ÿåº¦ä¸ºï¼š8.1MB/s

{% highlight bash %}
scp M.img test@10.10.10.1:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000171.png)

FPGA/ARM ç«¯æ‹·è´é€Ÿåº¦ä¸ºï¼š8.1MB/s

-------------------------------

### <span id="D025">20 æ¬¡ 200M</span>

ä½¿ç”¨ scp æ‹·è´ 200M çš„æ–‡ä»¶ 20 æ¬¡ï¼Œä½¿ç”¨å‘½ä»¤ï¼š

###### X86 ç«¯

{% highlight bash %}
scp M.img root@10.10.10.5:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000172.png)

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000173.png)

###### FPGA/ARM ç«¯

{% highlight bash %}
scp M.img test@10.10.10.1:/tmp
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000174.png)

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000175.png)

-------------------------------------

#### <span id="D03">iperf TCP</span>

iperf æ˜¯ä¸€ä¸ªç½‘ç»œæ€§èƒ½æµ‹è¯•å·¥å…·ã€‚iperfå¯ä»¥æµ‹è¯•æœ€å¤§ TCP å’Œ UDP å¸¦å®½æ€§èƒ½ã€‚iperf
å…·æœ‰å¤šç§å‚æ•°å’ŒUDPç‰¹æ€§ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ã€‚iperf å¯ä»¥æŠ¥å‘Šå¸¦å®½ï¼Œå»¶è¿ŸæŠ–åŠ¨å’Œæ•°æ®
åŒ…ä¸¢å¤±ã€‚

iperf TCP å¯ç”¨äºæµ‹è¯•ï¼š1ï¼‰æµ‹é‡ç½‘ç»œå¸¦å®½ã€‚2ï¼‰æŠ¥å‘Š MSS/MTU å€¼çš„å¤§å°å’Œè§‚æµ‹å€¼ã€‚
3ï¼‰æ”¯æŒ TCP çª—å£å€¼é€šè¿‡å¥—æ¥å­—ç¼“å†²ã€‚ 4ï¼‰å½“ P çº¿ç¨‹æˆ– Win3 2çº¿ç¨‹å¯ç”¨æ—¶ï¼Œ
æ”¯æŒå¤šçº¿ç¨‹ã€‚å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯æ”¯æŒåŒæ—¶å¤šé‡è¿æ¥ã€‚æœ¬èŠ‚ç”¨äºæµ‹è¯• TCP ç›¸å…³æ€§èƒ½ã€‚
X64 ç«¯ IP: 10.10.10.1ã€‚FGPA/ARM ç«¯ IP: 10.10.10.5ã€‚æµ‹è¯•é¡¹ç›®å¦‚ä¸‹ï¼š

> - [TCP æ€§èƒ½æµ‹è¯•](#D030)
>
> - [TCP 800M å¸¦å®½ 5 å°æ—¶æµ‹è¯•](#D031)
>
> - [TCP åŒå‘æµ‹è¯•](#D032)

-------------------------------

#### <span id="D030">TCP æ€§èƒ½æµ‹è¯•</span>

iperf æµ‹è¯•ï¼ŒX86 ç«¯ä½œä¸º serverï¼ŒFPGA/ARM ç«¯ä½œä¸º clientï¼Œä½¿ç”¨çš„æµ‹è¯•
å‘½ä»¤å¦‚ä¸‹ï¼š

{% highlight bash %}
Server:
  iperf3 -s

Client:
  iperf3 -c 10.10.10.1 -t 5
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000176.png)

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000177.png)

iperf æµ‹è¯•ï¼ŒFPGA/ARM ç«¯ä½œä¸º serverï¼ŒX86 ç«¯ä½œä¸º client, ä½¿ç”¨çš„æµ‹è¯•å‘½ä»¤
å¦‚ä¸‹ï¼š

{% highlight bash %}
Server:
  iperf3 -s

Client:
  iperf3 -c 10.10.10.5 -t 5
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000178.png)

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000179.png)

-------------------------------

# <span id="D031">TCP 800M å¸¦å®½ 5 å°æ—¶æµ‹è¯•</span>

iperf æµ‹è¯•ï¼ŒX86 ç«¯ä½œä¸º serverï¼ŒFPGA/ARM ç«¯ä½œä¸º clientï¼Œä½¿ç”¨çš„æµ‹è¯•
å‘½ä»¤å¦‚ä¸‹ï¼š

{% highlight bash %}
Server:
  iperf3 -s

Client:
  iperf3 -c 10.10.10.1 -t 18000 -b 800M
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000180.png)

x86

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000181.png)

FPGA/ARM

-------------------------------

# <span id="D032">TCP åŒå‘æµ‹è¯•</span>

iperf æµ‹è¯•ï¼ŒX86 ç«¯ä½œä¸º serverï¼ŒFPGA/ARM ç«¯ä½œä¸º clientï¼Œä½¿ç”¨çš„æµ‹è¯•
å‘½ä»¤å¦‚ä¸‹ï¼š

{% highlight bash %}
Server:
  iperf3 -s

Client:
  iperf3 -c 10.10.10.1 -t 20 -b 400M -d
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000182.png)

x86

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000183.png)

FPGA/ARM

-------------------------------------

#### <span id="D04">iperf UDP</span>

iperf æ˜¯ä¸€ä¸ªç½‘ç»œæ€§èƒ½æµ‹è¯•å·¥å…·ã€‚iperfå¯ä»¥æµ‹è¯•æœ€å¤§ TCP å’Œ UDP å¸¦å®½æ€§èƒ½ã€‚iperf
å…·æœ‰å¤šç§å‚æ•°å’ŒUDPç‰¹æ€§ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ã€‚iperf å¯ä»¥æŠ¥å‘Šå¸¦å®½ï¼Œå»¶è¿ŸæŠ–åŠ¨å’Œæ•°æ®
åŒ…ä¸¢å¤±ã€‚

iperf TCP å¯ç”¨äºæµ‹è¯•ï¼š1ï¼‰å®¢æˆ·ç«¯å¯ä»¥åˆ›å»ºæŒ‡å®šå¸¦å®½çš„ UDP æµã€‚2ï¼‰æµ‹é‡ä¸¢åŒ…ã€‚
3ï¼‰æµ‹é‡å»¶è¿Ÿã€‚4ï¼‰æ”¯æŒå¤šæ’­ã€‚5ï¼‰å½“Pçº¿ç¨‹å¯ç”¨æ—¶ï¼Œæ”¯æŒå¤šçº¿ç¨‹ã€‚
X64 ç«¯ IP: 10.10.10.1ã€‚FGPA/ARM ç«¯ IP: 10.10.10.5ã€‚æµ‹è¯•é¡¹ç›®å¦‚ä¸‹ï¼š

> - [UDP æ€§èƒ½æµ‹è¯•](#D040)
>
> - [UDP å¸¦å®½æµ‹è¯•](#D041)
>
> - [UDP åŒå‘æµ‹è¯•](#D042)
>
> - [UDP ä¸¢åŒ…æµ‹è¯•](#D042)

-------------------------------

# <span id="D040"></span>

iperf æµ‹è¯•ï¼ŒX86 ç«¯ä½œä¸º serverï¼ŒFPGA/ARM ç«¯ä½œä¸º clientï¼Œä½¿ç”¨çš„æµ‹è¯•
å‘½ä»¤å¦‚ä¸‹ï¼š

{% highlight bash %}
Server:
  iperf3 -s

Client:
  iperf3 -c 10.10.10.1 -t 5 -u -b 400M
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000184.png)

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000185.png)

iperf æµ‹è¯•ï¼ŒFPGA/ARM ç«¯ä½œä¸º serverï¼ŒX86 ç«¯ä½œä¸º client, ä½¿ç”¨çš„æµ‹è¯•å‘½ä»¤
å¦‚ä¸‹ï¼š

{% highlight bash %}
Server:
  iperf3 -s

Client:
  iperf3 -c 10.10.10.5 -t 5 -u -b 400M
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000186.png)

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000187.png)

-------------------------------

# <span id="D041">UDP å¸¦å®½æµ‹è¯•</span>

iperf æµ‹è¯•ï¼ŒX86 ç«¯ä½œä¸º serverï¼ŒFPGA/ARM ç«¯ä½œä¸º clientï¼Œæœ€å¤§å¸¦å®½å®šä¹‰
ä¸ºå¼€å§‹ä¸¢åŒ…çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æµ‹è¯•å‘½ä»¤å¦‚ä¸‹ï¼š

{% highlight bash %}
Server:
  iperf3 -s

Client:
  iperf3 -c 10.10.10.1 -t 5 -u -b MaxM
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000188.png)

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000189.png)

ä»ä¸Šé¢çš„æµ‹è¯•å¯ä»¥çœ‹å‡ºï¼Œå¸¦å®½å¯æ»¡è¶³ 1500Mã€‚

iperf æµ‹è¯•ï¼ŒFPGA/ARM ç«¯ä½œä¸º serverï¼ŒX86 ç«¯ä½œä¸º clientï¼Œæœ€å¤§å¸¦å®½å®šä¹‰
ä¸ºå¼€å§‹ä¸¢åŒ…çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æµ‹è¯•å‘½ä»¤å¦‚ä¸‹ï¼š

{% highlight bash %}
Server:
  iperf3 -s

Client:
  iperf3 -c 10.10.10.5 -t 5 -u -b MaxM
{% endhighlight %}

![](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/boot/BOOT000190.png)

-------------------------------------

#### <span id="D05">Socket</span>

Socket çš„è‹±æ–‡åŸä¹‰æ˜¯ â€œå­”â€ æˆ– â€œæ’åº§â€ã€‚ä½œä¸º BSD UNIX çš„è¿›ç¨‹é€šä¿¡æœºåˆ¶ï¼Œå–åä¸€ç§
æ„æ€ã€‚é€šå¸¸ä¹Ÿç§°ä½œ"å¥—æ¥å­—"ï¼Œç”¨äºæè¿°IPåœ°å€å’Œç«¯å£ï¼Œæ˜¯ä¸€ä¸ªé€šä¿¡é“¾çš„å¥æŸ„ï¼Œå¯ä»¥ç”¨æ¥
å®ç°ä¸åŒè™šæ‹Ÿæœºæˆ–ä¸åŒè®¡ç®—æœºä¹‹é—´çš„é€šä¿¡ã€‚åœ¨ Internet ä¸Šçš„ä¸»æœºä¸€èˆ¬è¿è¡Œäº†å¤šä¸ªæœåŠ¡
è½¯ä»¶ï¼ŒåŒæ—¶æä¾›å‡ ç§æœåŠ¡ã€‚æ¯ç§æœåŠ¡éƒ½æ‰“å¼€ä¸€ä¸ª Socketï¼Œå¹¶ç»‘å®šåˆ°ä¸€ä¸ªç«¯å£ä¸Šï¼Œä¸åŒçš„
ç«¯å£å¯¹åº”äºä¸åŒçš„æœåŠ¡ã€‚Socket æ­£å¦‚å…¶è‹±æ–‡åŸä¹‰é‚£æ ·ï¼Œåƒä¸€ä¸ªå¤šå­”æ’åº§ã€‚ä¸€å°ä¸»æœºçŠ¹å¦‚
å¸ƒæ»¡å„ç§æ’åº§çš„æˆ¿é—´ï¼Œæ¯ä¸ªæ’åº§æœ‰ä¸€ä¸ªç¼–å·ï¼Œæœ‰çš„æ’åº§æä¾› 220 ä¼äº¤æµç”µï¼Œ æœ‰çš„æä¾›
110 ä¼äº¤æµç”µï¼Œæœ‰çš„åˆ™æä¾›æœ‰çº¿ç”µè§†èŠ‚ç›®ã€‚ å®¢æˆ·è½¯ä»¶å°†æ’å¤´æ’åˆ°ä¸åŒç¼–å·çš„æ’åº§ï¼Œå°±å¯
ä»¥å¾—åˆ°ä¸åŒçš„æœåŠ¡ã€‚X64 ç«¯ IP: 10.10.10.1ã€‚FGPA/ARM ç«¯ IP: 10.10.10.5ã€‚

> - [Socket TCP ä¸å®šé•¿æµ‹è¯•](#D050)

-------------------------------

# <span id="D050">Socket TCP ä¸å®šé•¿æµ‹è¯•</span>

Socket ä¸å®šé•¿æµ‹è¯•æ˜¯ç”¨äºæµ‹è¯•é•¿åº¦éšæœºçš„ç½‘ç»œæ•°æ®åŒ…ä¼ è¾“ã€‚æµ‹è¯•æ–¹æ³•æ˜¯åœ¨ä¸€ç«¯å¼€å¯
æœåŠ¡å™¨ç«¯ socket ç¨‹åºï¼Œå¦å¤–ä¸€ç«¯å¼€å¯å®¢æˆ·ç«¯ socket ç¨‹åºã€‚æµ‹è¯•ç¨‹åºå¦‚ä¸‹ï¼š

> [TCP server ç«¯æµ‹è¯•ç¨‹åº](https://github.com/BiscuitOS/HardStack/blob/master/CodeSegment/socket/TCP/tcp_server.c)
>
> [TCP client ç«¯æµ‹è¯•ç¨‹åº](https://github.com/BiscuitOS/HardStack/blob/master/CodeSegment/socket/TCP/tcp_client.c)

-----------------------------------------------

# <span id="é™„å½•">é™„å½•</span>

> [BiscuitOS Home](https://biscuitos.github.io/)
>
> [BiscuitOS Driver](https://biscuitos.github.io/blog/BiscuitOS_Catalogue/)
>
> [BiscuitOS Kernel Build](https://biscuitos.github.io/blog/Kernel_Build/)
>
> [Linux Kernel](https://www.kernel.org/)
>
> [Bootlin: Elixir Cross Referencer](https://elixir.bootlin.com/linux/latest/source)
>
> [æ­å»ºé«˜æ•ˆçš„ Linux å¼€å‘ç¯å¢ƒ](https://biscuitos.github.io/blog/Linux-debug-tools/)

## èµèµä¸€ä¸‹å§ ğŸ™‚

![MMU](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/BiscuitOS/kernel/HAB000036.jpg)
