---
layout:             post
title:              ".abort or .ABORT"
date:               2019-03-26 08:37:30 +0800
categories:         [MMU]
excerpt:            GNU ASM .abort or .ABORT.
tags:
  - MMU
---

> [GitHub ASM code: .abort](https://github.com/BiscuitOS/HardStack/tree/master/Language/Assembly/ARM-GNU-Assembly/Instruction/%5B.abort%5D)
>
> Email: BuddyZhang1 <buddy.zhang@aliyun.com>

# ç›®å½•

> - [åŸç†](#åŸç†)
>
> - [å®è·µ](#å®è·µ)
>
> - [é™„å½•](#é™„å½•)

--------------------------------------------------------------
<span id="åŸç†"></span>

![MMU](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/IND00000A.jpg)

# åŸç†

.abort ä¼ªæŒ‡ä»¤ç”¨äºä¸­æ–­æŸæ®µæ±‡ç¼–ä»£ç çš„æ±‡ç¼–ã€‚å¦‚æœæ±‡ç¼–ä»£ç ä¸­æ·»åŠ äº† .abort æˆ–è€…
.ABORT æŒ‡ä»¤ï¼Œé‚£ä¹ˆæ±‡ç¼–å™¨ä¼šä¸»åŠ¨åœæ­¢ç¼–è¯‘ã€‚

--------------------------------------------------------------
<span id="å®è·µ"></span>

![MMU](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/IND00000P.jpg)

# å®è·µ

> - [å®è·µå‡†å¤‡](#å®è·µå‡†å¤‡)
>
> - [å®è·µç›®çš„](#å®è·µç›®çš„)
>
> - [å®è·µæºç ](#å®è·µæºç )
>
> - [æºç å®‰è£…](#æºç å®‰è£…)
>
> - [é…ç½®å†…æ ¸](#é…ç½®å†…æ ¸)
>
> - [è¿è¡Œæµ‹è¯•](#è¿è¡Œæµ‹è¯•)
>
> - [è¿è¡Œåˆ†æ](#è¿è¡Œåˆ†æ)

##### <span id="å®è·µå‡†å¤‡">å®è·µå‡†å¤‡</span>

æœ¬æ•™ç¨‹åŸºäº Linux 5.0 æºç è¿›è¡Œå®è·µï¼Œå¦‚æœè¿˜æœªæ­å»ºå¼€å‘ç¯å¢ƒï¼Œè¯·å‚è€ƒä¸‹é¢æ–‡æ¡£ï¼š

> [Linux 5.0 arm32 å¼€å‘ç¯å¢ƒæ­å»ºæ•™ç¨‹](https://biscuitos.github.io/blog/Linux-5.0-arm32-Usermanual/)

ç”±äºæœ¬æ•™ç¨‹çš„å®è·µéœ€è¦åœ¨ ARM çš„ Boot Stage 1 é˜¶æ®µè¿›è¡Œå®è·µï¼Œæ‰€ä»¥æœªæ­å»º Boot Stage 1
é˜¶æ®µè°ƒè¯•ç¯å¢ƒçš„è¯·å‚è€ƒæ–‡æ¡£ï¼š

> [ARM Boot Stage debugging usermanual](https://biscuitos.github.io/blog/BOOTASM-debuggingTools/#header)

##### <span id="å®è·µç›®çš„">å®è·µç›®çš„</span>

æœ¬ä¾‹å­ç”¨äºä»‹ç»å†…æ ¸ä¸­å¦‚ä½•ä½¿ç”¨è¯¥ä¼ªæŒ‡ä»¤ã€‚

##### <span id="å®è·µæºç ">å®è·µæºç </span>

{% highlight base %}
/*
 * GNU ARM assembly
 *
 * (C) 2019.03.26 BuddyZhang1 <buddy.zhang@aliyun.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */
#include <linux/linkage.h>
#include <asm/assembler.h>
#include <asm/v7m.h>

#include "efi-header.S"

/*
 * .abort
 *
 * This directive stops the assembly immediately. It is for compatibility
 * with other assemblers. The original idea was that the assembly language
 * source would be piped into the assembler. If the sender of the source
 * quit, it could use this directive to tell as to quit also. One day .abort
 * will not be supported.
 *
 * .ABORT is accepted as an alternate spelling of .abort.
 */

ENTRY(BS_func)
	.abort
	mov r0, r0
	ret     lr
ENDPROC(BS_func)
{% endhighlight %}

##### <span id="æºç å®‰è£…">æºç å®‰è£…</span>

å°†æºç å‘½åä¸º bs_debug.S, å¹¶ä¿å­˜åˆ°å†…æ ¸æºç  BiscuitOS/output/linux-5.0-arm32/linux/linux/arch/arm/boot/compressed/
ç›®å½•ä¸‹ï¼Œç„¶åæ ¹æ®ä¸‹é¢çš„è¡¥ä¸æ–‡ä»¶ï¼Œä¿®æ”¹å¯¹åº”çš„ Makefile å’Œ Kconfigã€‚

{% highlight base %}
From 9e071cc349949c934a803dc34b0ab0f514ba71bb Mon Sep 17 00:00:00 2001
From: BuddyZhang1 <buddy.zhang@aliyun.com>
Date: Tue, 26 Mar 2019 08:33:19 +0800
Subject: [PATCH 1/1] Debug ARM asm install

---
 arch/arm/boot/compressed/Makefile | 4 ++++
 drivers/BiscuitOS/Kconfig         | 7 +++++++
 drivers/Makefile                  | 1 +
 3 files changed, 12 insertions(+)
 create mode 100644 drivers/BiscuitOS/Kconfig

diff --git a/arch/arm/boot/compressed/Makefile b/arch/arm/boot/compressed/Makefile
index 6114ae6..644b722 100644
--- a/arch/arm/boot/compressed/Makefile
+++ b/arch/arm/boot/compressed/Makefile
@@ -39,6 +39,10 @@ ifeq ($(CONFIG_ARCH_SA1100),y)
 OBJS		+= head-sa1100.o
 endif

+ifeq ($(CONFIG_BISCUITOS_ASM_BOOT),y)
+OBJS		+= bs_asm.o
+endif
+
 ifeq ($(CONFIG_CPU_XSCALE),y)
 OBJS		+= head-xscale.o
 endif
diff --git a/drivers/BiscuitOS/Kconfig b/drivers/BiscuitOS/Kconfig
new file mode 100644
index 0000000..99a7a40
--- /dev/null
+++ b/drivers/BiscuitOS/Kconfig
@@ -0,0 +1,7 @@
menuconfig BISCUITOS_DRV
	bool "BiscuitOS Driver"

+config BISCUITOS_ASM_BOOT
+	bool "asm boot"
+
endif # BISCUITOS_DRV
diff --git a/drivers/Makefile b/drivers/Makefile
index e1ce029..7c057e3 100644
--- a/drivers/Makefile
+++ b/drivers/Makefile
@@ -186,3 +186,4 @@ obj-$(CONFIG_MULTIPLEXER)	+= mux/
 obj-$(CONFIG_UNISYS_VISORBUS)	+= visorbus/
 obj-$(CONFIG_SIOX)		+= siox/
 obj-$(CONFIG_GNSS)		+= gnss/
+obj-$(CONFIG_BISCUITOS_DRV)     += BiscuitOS/
--
2.7.4
{% endhighlight %}

##### <span id="é…ç½®å†…æ ¸">é…ç½®å†…æ ¸</span>

æ ¹æ®æ–‡æ¡£ä»‹ç»çš„æ–¹æ³•é…ç½®å†…æ ¸ï¼Œé€‰é¡¹å¦‚ä¸‹ï¼š

{% highlight base %}
Device Driver--->
    [*]BiscuitOS Driver--->
        [*]asm boot
{% endhighlight %}

##### <span id="è¿è¡Œæµ‹è¯•">è¿è¡Œæµ‹è¯•</span>

å¼€å‘è€…å¯ä»¥æ ¹æ® <Linux 5.0 arm32 æ‰‹å†Œ> è¿›è¡Œç¼–è¯‘å’Œè¿è¡Œï¼Œè¿è¡Œæ—¶çš„ç»“æœå¦‚ä¸‹ï¼š

{% highlight base %}
buddy@BDOS:/xspace/OpenSource/BiscuitOS/BiscuitOS/output/linux-5.0-arm32/linux/linux$ make ARCH=ar
m CROSS_COMPILE=/xspace/OpenSource/BiscuitOS/BiscuitOS/output/linux-5.0-arm32/arm-linux-gnueabi/arm-linux-gnueabi/bin/arm-linux-gnueabi- -j4
  CALL    scripts/checksyscalls.sh
  CHK     include/generated/compile.h
  Kernel: arch/arm/boot/Image is ready
  Building modules, stage 2.
  MODPOST 6 modules
  AS      arch/arm/boot/compressed/head.o
  AS      arch/arm/boot/compressed/bs_asm.o
arch/arm/boot/compressed/bs_asm.S: Assembler messages:
arch/arm/boot/compressed/bs_asm.S:29: Fatal error: .abort detected.  Abandoning ship.
scripts/Makefile.build:367: recipe for target 'arch/arm/boot/compressed/bs_asm.o' failed
make[2]: *** [arch/arm/boot/compressed/bs_asm.o] Error 1
arch/arm/boot/Makefile:64: recipe for target 'arch/arm/boot/compressed/vmlinux' failed
make[1]: *** [arch/arm/boot/compressed/vmlinux] Error 2
arch/arm/Makefile:340: recipe for target 'zImage' failed
make: *** [zImage] Error 2
{% endhighlight %}

##### <span id="è¿è¡Œåˆ†æ">è¿è¡Œåˆ†æ</span>

ä»ä¸Šå›¾çš„è¿è¡Œçœ‹å‡ºï¼Œåœ¨æ±‡ç¼– bs_arm.o è¿‡ç¨‹ä¸­ï¼Œæ±‡ç¼–è¿‡ç¨‹è¢«ä¸­æ–­äº†ï¼Œæ‰€ä»¥ .abort èµ·åˆ°äº†
ä¸­æ–­æ±‡ç¼–è¿‡ç¨‹çš„ä½œç”¨ã€‚

-----------------------------------------------

# <span id="é™„å½•">é™„å½•</span>

> [The GNU Assembler](http://tigcc.ticalc.org/doc/gnuasm.html)
>
> [The GNU Assembly: .abort](http://tigcc.ticalc.org/doc/gnuasm.html#SEC68)
>
> [Debugging on ARM Boot Stage](https://biscuitos.github.io/blog/BOOTASM-debuggingTools/#header)
>
> [BiscuitOS Home](https://biscuitos.github.io/)
>
> [BiscuitOS Driver](https://biscuitos.github.io/blog/BiscuitOS_Catalogue/)
>
> [BiscuitOS Kernel Build](https://biscuitos.github.io/blog/Kernel_Build/)
>
> [Linux Kernel](https://www.kernel.org/)
>
> [Bootlin: Elixir Cross Referencer](https://elixir.bootlin.com/linux/latest/source)
>
> [æ­å»ºé«˜æ•ˆçš„ Linux å¼€å‘ç¯å¢ƒ](https://biscuitos.github.io/blog/Linux-debug-tools/)

## èµèµä¸€ä¸‹å§ ğŸ™‚

![MMU](https://raw.githubusercontent.com/EmulateSpace/PictureSet/master/BiscuitOS/kernel/HAB000036.jpg)
